<div class="severity-container">
  <!-- Always show dropdown mode (for bulk dialog where editable=false) -->
  @if (!editable) {
    <div>
      <!-- Editable dropdown -->
      @if (canEdit) {
        <div>
          <p-select
            [options]="severityOptions"
            [ngModel]="currentSeverityValue"
            (ngModelChange)="onSeverityChange($event)"
            optionLabel="label"
            optionValue="value"
            placeholder="Severity"
            [style]="{'width': '140px'}"
            styleClass="severity-dropdown"
            (click)="$event.stopPropagation()">
          </p-select>
        </div>
      }
      <!-- Read-only badge when no edit permission -->
      @if (!canEdit && hasSeverity) {
        <div>
          <span [ngClass]="severityBadgeClass" class="severity-badge px-2 py-1 rounded text-xs">
            {{ severityLabel }}
          </span>
        </div>
      }
    </div>
  }

  <!-- Click-to-edit mode (for comment threads where editable=true) -->
  @if (editable && hasSeverity) {
    <div>
      @if (canEdit) {
        <div>
          <!-- Edit mode -->
          @if (isEditingMode) {
            <div class="severity-edit-container">
              <p-select
                [options]="severityOptions"
                [ngModel]="currentSeverityValue"
                (ngModelChange)="onSeverityChange($event)"
                (onHide)="onDropdownHide()"
                optionLabel="label"
                optionValue="value"
                [style]="{'min-width': '100px', 'font-size': '0.75rem'}"
                styleClass="severity-dropdown"
                (click)="$event.stopPropagation()">
              </p-select>
            </div>
          }
          <!-- Badge with edit icon -->
          @if (!isEditingMode) {
            <div
              class="severity-badge-editable d-flex align-items-center"
              [ngClass]="severityBadgeClass"
              (click)="startEditing(); $event.stopPropagation()">
              <span class="severity-text">{{ severityLabel }}</span>
              <i class="pi pi-pencil ms-1 severity-edit-icon"></i>
            </div>
          }
        </div>
      }
      <!-- Read-only mode (no edit permission) -->
      @if (!canEdit) {
        <div>
          <span [ngClass]="severityBadgeClass" class="severity-badge px-2 py-1 rounded text-xs">
            {{ severityLabel }}
          </span>
        </div>
      }
    </div>
  }
</div>
