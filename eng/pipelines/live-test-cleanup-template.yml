parameters:
  - name: DisplayName
    type: string
  - name: SubscriptionConfigurations
    type: object
    default:
      - $(sub-config-azure-cloud-test-resources)
  - name: AdditionalParameters
    type: string
    default: ""

steps:
  - template: /eng/common/TestResources/build-test-resource-config.yml
    parameters:
      SubscriptionConfigurations: ${{ parameters.SubscriptionConfigurations }}

  - pwsh: |
      eng/common/scripts/Import-AzModules.ps1
      Import-Module Az.Accounts

      $subscriptionConfiguration = @'
        $(SubscriptionConfiguration)
      '@ | ConvertFrom-Json -AsHashtable

      ./eng/scripts/live-test-resource-cleanup.ps1 `
      @subscriptionConfiguration `
      -WhatIf `
      -Verbose ${{ parameters.AdditionalParameters }}
    displayName: ${{ parameters.DisplayName }}
    continueOnError: true

