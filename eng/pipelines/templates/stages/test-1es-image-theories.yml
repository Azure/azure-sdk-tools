extends:
  template: /eng/pipelines/templates/stages/1es-redirect.yml
  parameters:
    stages:
      - stage: 'Investigate'
        variables:
          - template: /eng/pipelines/templates/variables/globals.yml
          - template: /eng/pipelines/templates/variables/image.yml
        jobs:
          - job: 'MacOS'

            pool:
              name: $(MACOSPOOL)
              image: $(MACOSVMIMAGE)
              os: macos

            steps:
              - pwsh: |
                  dotnet --list-sdks
                displayName: 'Run dotnet --list-sdks'

              - pwsh: |
                  Write-Host "$(DOTNET_HOST)"
                displayName: 'Dump Default DOTNET_HOST value'

              - template: /eng/common/testproxy/test-proxy-tool.yml

              - pwsh: |
                  Write-Host "$(DOTNET_HOST)"
                displayName: 'Dump DOTNET_HOST value after installation and run of Test Proxy'

              - template: /eng/common/testproxy/publish-proxy-logs.yml

          - job: 'Windows'

            pool:
              name: $(WINDOWSPOOL)
              image: $(WINDOWSVMIMAGE)
              os: windows

            steps:
              - pwsh: |
                  dotnet --list-sdks
                displayName: 'Run dotnet --list-sdks'

              - pwsh: |
                  Write-Host "$(DOTNET_HOST)"
                displayName: 'Dump Default DOTNET_HOST value'

              - template: /eng/common/testproxy/test-proxy-tool.yml

              - pwsh: |
                  Write-Host "$(DOTNET_HOST)"
                displayName: 'Dump DOTNET_HOST value after installation and run of Test Proxy'

              - template: /eng/common/testproxy/publish-proxy-logs.yml

          - job: 'Linux'

            pool:
              name: $(LINUXPOOL)
              image: $(LINUXVMIMAGE)
              os: linux

            steps:
              - pwsh: |
                  dotnet --list-sdks
                displayName: 'Run dotnet --list-sdks'

              - pwsh: |
                  Write-Host "$(DOTNET_HOST)"
                displayName: 'Dump Default DOTNET_HOST value'

              - template: /eng/common/testproxy/test-proxy-tool.yml

              - pwsh: |
                  Write-Host "$(DOTNET_HOST)"
                displayName: 'Dump DOTNET_HOST value after installation and run of Test Proxy'

              - template: /eng/common/testproxy/publish-proxy-logs.yml