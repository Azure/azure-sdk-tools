!function(){"use strict";$((()=>{const e="invisible",t=".icon-comments",n=".comment-cell";let a=!1;function o(){if(!(location.hash.length<1)){var e=m(location.hash.substring(1));e.addClass("active"),e.on("animationend",(()=>{e.removeClass("active")}))}}function c(e){return l(e,"data-revision-id")}function i(e){return l(e,"data-line-id")}function r(e){return l(e,"data-comment-id")}function l(e,t){return $(e).closest(`[${t}]`).attr(t)}function d(e){return $(`.review-comment[data-comment-id='${e}']`)}function s(e){return $(`.comment-row[data-line-id='${e}']`)}function m(e){return $(`.code-line[data-line-id='${e}']`)}function u(e){return $(`.code-diagnostics[data-line-id='${e}']`)}function f(e){let t,n=s(e);if(0===n.length)t=h(),n=$(`<tr class="comment-row" data-line-id="${e}">`).append($('<td colspan="3">').append(t)),n.insertAfter(u(e).get(0)||m(e).get(0));else{let e=$(n).find(".review-thread-reply");t=$(n).find(".comment-form"),0===t.length&&(t=$(h()).insertAfter(e)),e.hide(),t.show(),n.show()}$(u(e)).show(),$("#show-comments-checkbox").prop("checked")||g(e,!0),t.find(".new-thread-comment-text").focus()}function h(){return $("#js-comment-form-template").children().clone()}function p(){a||($(".line-comment-button-cell").append('<span class="icon icon-comments invisible"><i class="far fa-comment-alt pt-1 pl-1"></i></span>'),a=!0)}function g(n,a){m(n).find(t).toggleClass(e,!a)}function v(){var e=$(".comment-row");e.each((function(t){var n="comment-thread-"+t;$(this).find(".comment-thread-anchor").first().prop("id",n);var a=$(this).find(".comment-navigation-buttons").last();a.empty();var o="comment-thread-"+(t+1),c="comment-thread-"+(t-1);1!=e.length&&(0==t?a.append(`<a class="btn btn btn-outline-secondary" href="#${o}"><i class="fa fa-chevron-down" aria-hidden="true"></i></a>`):t==e.length-1?a.append(`<a class="btn btn btn-outline-secondary" href="#${c}"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>`):(a.append(`<a class="btn btn btn-outline-secondary" href="#${c}"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>`),a.append(`<a class="btn btn btn-outline-secondary ml-1" href="#${o}"><i class="fa fa-chevron-down" aria-hidden="true"></i></a>`)))}))}$(document).on("click",".commentable",(e=>{f(e.target.id),e.preventDefault()})),$(document).on("click",".line-comment-button",(e=>{let t=i(e.target);t&&f(t),e.preventDefault()})),$(document).on("click",".comment-cancel-button",(a=>{let o=i(a.target);o&&(function(e){let t=s(e);t.find(".review-thread-reply").show(),t.find(".comment-form").hide()}(o),0===s(o).find(n).length&&m(o).find(t).addClass(e)),a.preventDefault()})),$(document).on("click","#show-comments-checkbox",(e=>{var t;p(),t=e.target.checked,$(n).each((function(){var e=i(this);e&&(s(e).toggle(t),g(e,!t))}))})),$(document).on("click","#show-system-comments-checkbox",(e=>{var t;p(),t=e.target.checked,$(".code-diagnostics").each((function(){var e=i(this);e&&(u(e).toggle(t),g(e,!t))}))})),$(document).on("click",t,(e=>{let t=i(e.target);var n;t&&(s(n=t).toggle(),u(n).toggle()),e.preventDefault()})),$(document).on("submit","form[data-post-update='comments']",(e=>{const t=$(e.target);let n=i(e.target);if(n){let o=s(n),i=t.serializeArray();i.push({name:"elementId",value:n}),i.push({name:"reviewId",value:(a=e.target,l(a,"data-review-id"))}),i.push({name:"revisionId",value:c(e.target)}),$.ajax({type:"POST",url:$(t).prop("action"),data:$.param(i)}).done((e=>{!function(e,t){t=$.parseHTML(t),$(e).replaceWith(t)}(o,e),v()}))}var a;e.preventDefault()})),$(document).on("click",".review-thread-reply-button",(e=>{let t=i(e.target);t&&f(t),e.preventDefault()})),$(document).on("click",".toggle-comments",(e=>{let t=i(e.target);t&&$(s(t)).find(".comment-holder").toggle(),e.preventDefault()})),$(document).on("click",".js-edit-comment",(e=>{let t=r(e.target);t&&function(e){let t=$(d(e)),n=function(e,t){let n=$("#js-comment-edit-form-template").children().clone();return n.find(".js-comment-id").val(e),n.find(".new-thread-comment-text").html(t),n}(e,t.find(".js-comment-raw").html());t.replaceWith(n)}(t),e.preventDefault()})),$(document).on("click",".js-github",(e=>{let t=$(e.target),n=t.attr("data-repo"),a=l(e.target,"data-language");a||(a=t.attr("data-repo-language"));let o=d(r(e.target)),c=o.find(".js-comment-raw").html(),s=o.closest(".comment-row").prev(".code-line").find(".code"),m="",u=s.find(".comment-url");m=u.length?location.protocol+"//"+location.host+escape(u.attr("href")):window.location.href.split("#")[0]+"%23"+escape(escape(i(o[0])));let f=escape("```"+a+"\n"+s.text().trim()+"\n```\n#\n"+c);window.open("https://github.com/Azure/"+n+"/issues/new?&body="+f,"_blank"),e.preventDefault()})),$(document).on("keydown",".new-thread-comment-text",(e=>{if(e.ctrlKey&&(10===e.keyCode||13===e.keyCode)){const t=$(e.target).closest("form");t&&t.submit(),e.preventDefault()}})),addEventListener("hashchange",(e=>{o()})),addEventListener("load",(e=>{o(),v()}))}))}();
//# sourceMappingURL=comments.js.map