{"testcase": "LRO header return 200", "query": "title: LRO header return 200\n\nquestion: Hi, I'm from the servicefabric RP team working with [azure-rest-api-specs/specification/servicefabricmanagedclusters/resource-manager/Microsoft.ServiceF…](https://github.com/Azure/azure-rest-api-specs/blob/main/specification/servicefabricmanagedclusters/resource-manager/Microsoft.ServiceFabric/ServiceFabricManagedClusters/preview/2025-06-01-preview/servicefabricmanagedclusters.json)\nOn our operations for ManagedClusters_CreateOrUpdate, NodeTypes_CreateOrUpdate, and ApplicationTypeVersions_CreateOrUpdate, we have both a 200 and 202 response defined.\nA 200 response is returned when the customer sends the initial request to create the resource. A 202 is returned on every subsequent PUT.\nI recently noticed that our service code returns an async operation URI in the 200 response for the above operations. https://msazure.visualstudio.com/One/_git/winfab-RP?path=/src/sfmc/SfmcBackendService/Service/Controllers/ClustersController.cs&version=GBdevelop&line=294&lineEnd=295&lineStartColumn=1&lineEndColumn=1&lineStyle=plain&_a=contents\n```\nHTTP/1.1 200 OK\nContent-length: 2131\nContent-Type: application/json; charset=utf-8\nServer: Microsoft-HTTPAPI/2.0\nAzure-AsyncOperation: http://localhost:8080/subscriptions/b36cdf46-b75d-4dc2-9fe1-1296ee8c623d/providers/Microsoft.ServiceFabric/locations/southcentralus/managedclusteroperations/c39cd8e1-18a0-41fc-a778-6a4ad6adbd653?api-version=2024-02-01\nDate: Thu, 23 Oct 2025 22:57:10 GMT\nConnection: close\n```\nShould I specify this in the spec? If so, what is the recommendation for doing so? I couldn't find an example for a 200 response with an async operation header.", "ground_truth": "Based on ARM RPC guidelines and the TypeSpec ARM templates:\n1.You generally should NOT model “subsequent PUT returns 202” for a resource PUT.\nFor ARM resource PUT, the required pattern is: return `201` for create and `200` for update, and if the operation is long-running you still use `x-ms-long-running-operation: true` and include the appropriate LRO headers.\nReturning `202` for PUT is explicitly called out as an old model and is no longer supported for new resource types/patterns.\n2.If your service returns an async polling header on the `200` response, it’s OK (and often desirable) to specify it — but only if the operation is actually long-running in that case.\nIn ARM, the LRO “polling” header is typically `Azure-AsyncOperation` (required for greenfield starting Jan 2025 per RPC contract) and/or `Location` (required for 202 patterns; also commonly used).\nFor PUT LROs, the standard ARM templates already model the correct behavior: `200` and `201` responses with the resource body, and LRO headers on the create response (and depending on template/pattern, can be present when the operation is async).\n3.Recommended way to model this in TypeSpec (preferred over hand-authoring swagger)\nUse the ARM operation template for async PUT, and let the emitter generate the correct OpenAPI, including `x-ms-long-running-operation-options.final-state-via`.\nIf you need `Azure-AsyncOperation` to be the final-state mechanism, use the template that emits that (e.g. `ArmResourceCreateOrUpdateAsync` / `ArmResourceCreateOrReplaceAsync` depending on your chosen semantics).\nExample (management-plane, ARM):\n```\nimport \"@azure-tools/typespec-azure-resource-manager\";\nusing Azure.ResourceManager;\n@armResourceOperations\ninterface ManagedClusters {\n// Pick the template that matches your service’s LRO header behavior.\n// This produces 200/201 + x-ms-long-running-operation and final-state-via azure-async-operation.\ncreateOrUpdate is ArmResourceCreateOrReplaceAsync<ManagedCluster>;\n}\n```\n4.If you truly must keep a 202-on-PUT behavior (brownfield), align it to ARM guidance rather than just documenting the current behavior.\nThe guidance is to fix the service to return `200/201` for PUT (even when async) and rely on LRO headers + provisioningState.\nIf you cannot change runtime behavior immediately, you should discuss with ARM/API review because it conflicts with the current ARM contract guidance for PUT.\n5.About “200 response with async operation header” specifically\nIn OpenAPI/Swagger, you can absolutely define headers on the `200` response. There’s nothing structurally preventing it.\nHowever, the recommended ARM modeling is to use the standard templates so the LRO metadata is consistent (headers + `x-ms-long-running-operation` + `final-state-via`). Don’t invent a one-off pattern unless you have to.\nIf you paste the relevant snippet of your current swagger responses for one of these PUTs (the `responses` block), I can tell you exactly what to change and which TypeSpec template/parameters best match your service behavior (including whether you should be using `ArmResourceCreateOrReplaceAsync` vs `ArmResourceCreateOrUpdateAsync`, and whether you need `Location` and/or `Azure-AsyncOperation`).", "expected_knowledges": [{"title": "Resolving OpenAPI Breaking Change Violations | Migrating ARM Specifications | Converting Synchronous Operations to LROs", "link": "https://azure.github.io/typespec-azure/docs/migrate-swagger/faq/breakingchange"}, {"title": "TypeSpec Definitions | ArmResourceCreateOrUpdateAsync", "link": ""}, {"title": "TypeSpec ARM Model Mapping to Swagger Documentation | 1. ArmAcceptedLroResponse | Description", "link": ""}, {"title": "LRO Header Data Type", "link": ""}, {"title": "Extra \"TypeSpec.Http.OkResponse\" schema in new Swagger | answer", "link": "https://azure.github.io/typespec-azure/docs/migrate-swagger/faq/breakingchange"}, {"title": "Asynchronous API Reference | Rules ## | General impact of violating the rules ###", "link": "https://github.com/cloud-and-ai-microsoft/resource-provider-contract/blob/master/v1.0/async-api-reference.md"}, {"title": "remove body for lro | answer", "link": "https://azure.github.io/typespec-azure/docs/migrate-swagger/faq/breakingchange"}, {"title": "lro-location-header", "link": "https://azure.github.io/typespec-azure/docs/libraries/azure-resource-manager/rules/lro-location-header"}, {"title": "Deep Dive: Long-running (Asynchronous) Operations | Describing Custom LRO Patterns using Azure.Core", "link": "https://azure.github.io/typespec-azure/docs/howtos/azure-core/long-running-operations"}, {"title": "ArmResourceCreateOrReplaceAsync", "link": ""}, {"title": "Asynchronous API Reference | Azure-AsyncOperation Resource format", "link": "https://github.com/cloud-and-ai-microsoft/resource-provider-contract/blob/master/v1.0/async-api-reference.md"}, {"title": "missing Location header in LRO 202 response and \"final-state-via\": \"azure-async-operation\" | answer", "link": "https://azure.github.io/typespec-azure/docs/migrate-swagger/faq/breakingchange"}, {"title": "Asynchronous API Reference", "link": "https://github.com/cloud-and-ai-microsoft/resource-provider-contract/blob/master/v1.0/async-api-reference.md"}, {"title": "put-operation-response-codes", "link": "https://azure.github.io/typespec-azure/docs/libraries/azure-resource-manager/rules/put-operation-response-codes"}, {"title": "Linter usage | Rules", "link": "https://azure.github.io/typespec-azure/docs/libraries/azure-resource-manager/reference/linter"}, {"title": "use-standard-names", "link": "https://azure.github.io/typespec-azure/docs/libraries/azure-core/rules/use-standard-names"}, {"title": "Data types | Azure.ResourceManager | `ArmResourceCreatedResponse` {#Azure.ResourceManager.ArmResourceCreatedResponse}", "link": "https://azure.github.io/typespec-azure/docs/libraries/azure-resource-manager/reference/data-types"}, {"title": "TypeSpec Azure.ResourceManager.Extension Operations Mapping to Swagger Documentation | 9. CreateOrUpdateAsync | Swagger Output", "link": ""}, {"title": "TypeSpec Azure.ResourceManager.Legacy Operations Mapping to Swagger Documentation | 4. CreateOrReplaceAsync | Swagger Output", "link": ""}, {"title": "TypeSpec Definitions | ArmResourceCreateOrReplaceAsync", "link": ""}], "expected_references": [{"title": "Asynchronous API Reference", "link": "https://github.com/cloud-and-ai-microsoft/resource-provider-contract/blob/master/v1.0/async-api-reference.md"}, {"title": "put-operation-response-codes", "link": "https://azure.github.io/typespec-azure/docs/libraries/azure-resource-manager/rules/put-operation-response-codes"}, {"title": "TypeSpec Definitions | ArmResourceCreateOrUpdateAsync", "link": ""}, {"title": "LRO Header Data Type", "link": ""}]}
