parameters:
  os: '$(Agent.OS)'

steps:
  - bash: |
      which dotnet
    displayName: 'Which dotnet'

  - pwsh: |
      dotnet --list-sdks
    displayName: 'Run dotnet --list-sdks'

  - pwsh: |
      Get-ChildItem Env: | Format-List
    displayName: 'Dump Environment'

  - template: /eng/common/testproxy/test-proxy-tool.yml

  - template: /eng/common/testproxy/test-proxy-tool-shutdown.yml

  - pwsh: |
      $files = Get-ChildItem -Path $(Build.SourcesDirectory) -Filter test-proxy.log
      foreach($file in $files){
          Write-Host "##[group]$file"
          cat $file
          Write-Host "##[endgroup]"
      }
    displayName: Dump Test-Proxy Logs
    condition: succeededOrFailed()

  - pwsh: |
      $files = Get-ChildItem -Path $(Build.SourcesDirectory) -Filter test-proxy-error.log
      foreach($file in $files){
          Write-Host "##[group]$file"
          cat $file
          Write-Host "##[endgroup]"
      }
    displayName: Dump Test-Proxy Error Logs
    condition: succeededOrFailed()

  - pwsh: |
      Get-ChildItem Env: | Format-List
    displayName: 'Dump Environment'
    condition: succeededOrFailed()