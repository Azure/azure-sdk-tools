pr: none
trigger: none

parameters:
  - name: Subscriptions
    type: object
    default:
      - DisplayName: AzureCloud - Resource Cleanup
        SubscriptionConfigurations:
          - $(sub-config-azure-cloud-test-resources)
        AdditionalParameters: "-DeleteNonCompliantGroups"
      - SubscriptionConfigurations:
          - $(sub-config-cn-test-resources)
        AdditionalParameters: "-DeleteNonCompliantGroups"
      - DisplayName: AzureCloud Playground - Resource Cleanup
        SubscriptionConfigurations:
          - $(sub-config-azure-cloud-playground)
        AdditionalParameters: "-DeleteNonCompliantGroups"
      - DisplayName: Dogfood Translation - Resource Cleanup
        SubscriptionConfigurations:
          - $(sub-config-translation-int-test-resources)
      - DisplayName: Dogfood ACS - Resource Cleanup
        SubscriptionConfigurations:
          - $(sub-config-communication-int-test-resources-common)
      - DisplayName: AzureCloud ACS - Resource Cleanup
        SubscriptionConfigurations:
          - $(sub-config-azure-cloud-test-resources)
          - $(sub-config-communication-services-cloud-test-resources-common)
      - DisplayName: AzureCloud Cosmos - Resource Cleanup
        SubscriptionConfigurations:
          - $(sub-config-azure-cloud-test-resources)
          - $(sub-config-cosmos-azure-cloud-test-resources)
      - DisplayName: AzureCloud Storage NET - Resource Cleanup
        SubscriptionConfigurations:
          - $(sub-config-azure-cloud-test-resources)
          - $(sub-config-storage-test-resources-net)

stages:
- stage: Run

  variables:
  - template: ./templates/variables/globals.yml

  jobs:
  - job: Run
    timeoutInMinutes: 0
    pool:
      vmImage: ubuntu-20.04

    steps:
      - template: /eng/common/pipelines/templates/steps/cache-ps-modules.yml

      # Register the dogfood environment to clean up any custom subscriptions in it
      - template: /eng/common/TestResources/setup-environments.yml

      - ${{ each subscription in parameters.Subscriptions }}:
        - template: ./live-test-cleanup-template.yml
          parameters:
            DisplayName: ${{ subscription.DisplayName }}
            SubscriptionConfigurations: ${{ subscription.SubscriptionConfigurations }}
            AdditionalParameters: ${{ subscription.AdditionalParameters }}
