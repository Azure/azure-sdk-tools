using Microsoft.Extensions.AI;

namespace Azure.Sdk.Tools.Cli.Evaluations.ToolMocks
{
    public class RunTypespecValidation : IToolMock
    {
        public string ToolName => "azsdk_run_typespec_validation";
        public string CallId => "tooluse_E4IlmABTSvaVU4YrPH6F";
        private string toolResult => """{"result":["Running TypeSpecValidation on folder:  C:/azure-rest-api-specs/specification/contosowidgetmanager/Contoso.WidgetManager\r\n\r\nExecuting rule: FolderStructure\r\n2025-10-23T00:24:45.170Z simple-git [GitExecutor] [SPAWN] git [ \u0027rev-parse\u0027, \u0027--show-toplevel\u0027 ]\r\n2025-10-23T00:24:45.250Z simple-git [GitExecutor] [HANDLE] retrieving task output complete\r\nfolder: C:/azure-rest-api-specs/specification/contosowidgetmanager/Contoso.WidgetManager\r\nconfig files: [\u0022C:/azure-rest-api-specs/specification/contosowidgetmanager/Contoso.WidgetManager/tspconfig.yaml\u0022]\r\nazure-resource-provider-folder: \u0022data-plane\u0022\r\nimports:\r\n  specification\\contosowidgetmanager\r\n    Contoso.Management/employee.tsp: []\r\n    Contoso.Management/main.tsp: [\u0022./employee.tsp\u0022]\r\n    Contoso.WidgetManager.Shared/main.tsp: []\r\n    Contoso.WidgetManager/client.tsp: [\u0022./main.tsp\u0022]\r\n    Contoso.WidgetManager/main.tsp: [\u0022../Contoso.WidgetManager.Shared\u0022]\r\n\r\n\r\nExecuting rule: NpmPrefix\r\n2025-10-23T00:24:45.275Z simple-git [GitExecutor] [SPAWN] git [ \u0027rev-parse\u0027, \u0027--show-toplevel\u0027 ]\r\n2025-10-23T00:24:45.333Z simple-git [GitExecutor] [HANDLE] retrieving task output complete\r\nexecFile(\u0022C:\\nvm4w\\nodejs\\node.exe\u0022, [\u0022--\u0022,\u0022C:\\\\nvm4w\\\\nodejs\\\\node_modules\\\\npm\\\\bin\\\\npm-cli.js\u0022,\u0022prefix\u0022])\r\nExpected npm prefix: C:/azure-rest-api-specs\r\nActual npm prefix: C:/azure-rest-api-specs\r\n\r\nExecuting rule: EmitAutorest\r\nmainTspExists: true\r\nemit: [\u0022@azure-tools/typespec-autorest\u0022]\r\n\r\n\r\nExecuting rule: FlavorAzure\r\n\u0022@azure-tools/typespec-python\u0022:\r\n  flavor: azure\r\n\u0022@azure-tools/typespec-csharp\u0022:\r\n  flavor: azure\r\n\u0022@azure-tools/typespec-ts\u0022:\r\n  flavor: azure\r\n\u0022@azure-tools/typespec-java\u0022:\r\n  flavor: azure\r\n\r\n\r\nExecuting rule: LinterRuleset\r\nazure-resource-provider-folder: \u0022data-plane\u0022\r\nfiles: [\u0022main.tsp\u0022,\u0022client.tsp\u0022]\r\nlinter.extends: [\u0022@azure-tools/typespec-azure-rulesets/data-plane\u0022]\r\n\r\nExecuting rule: Compile\r\nexecFile(\u0022C:\\nvm4w\\nodejs\\node.exe\u0022, [\u0022--\u0022,\u0022C:\\\\nvm4w\\\\nodejs\\\\node_modules\\\\npm\\\\bin\\\\npm-cli.js\u0022,\u0022exec\u0022,\u0022--no\u0022,\u0022--\u0022,\u0022tsp\u0022,\u0022compile\u0022,\u0022--list-files\u0022,\u0022--warn-as-error\u0022,\u0022C:/azure-rest-api-specs/specification/contosowidgetmanager/Contoso.WidgetManager\u0022])\r\nexecFile(\u0022C:\\nvm4w\\nodejs\\node.exe\u0022, [\u0022--\u0022,\u0022C:\\\\nvm4w\\\\nodejs\\\\node_modules\\\\npm\\\\bin\\\\npm-cli.js\u0022,\u0022exec\u0022,\u0022--no\u0022,\u0022--\u0022,\u0022tsp\u0022,\u0022compile\u0022,\u0022--no-emit\u0022,\u0022--warn-as-error\u0022,\u0022C:\\\\azure-rest-api-specs\\\\specification\\\\contosowidgetmanager\\\\Contoso.WidgetManager\\\\client.tsp\u0022])\r\n2025-10-23T00:24:53.377Z simple-git [GitExecutor] [SPAWN] git [ \u0027status\u0027, \u0027--porcelain\u0027, \u0027-b\u0027, \u0027-u\u0027, \u0027--null\u0027, \u0027--porcelain\u0027, \u0027C:/azure-rest-api-specs/specification/contosowidgetmanager\u0027 ]\r\n2025-10-23T00:24:53.780Z simple-git [GitExecutor] [HANDLE] retrieving task output complete\r\nTypeSpec compiler v1.2.1\r\n\r\n    \u001B[2mspecification/contosowidgetmanager/data-plane/Azure.Contoso.WidgetManager/preview/2022-11-01-preview/widgets.json\u001B[22m\r\n    \u001B[2mspecification/contosowidgetmanager/data-plane/Azure.Contoso.WidgetManager/preview/2022-11-01-preview/examples/Widgets_GetWidgetSample.json\u001B[22m\r\n    \u001B[2mspecification/contosowidgetmanager/data-plane/Azure.Contoso.WidgetManager/preview/2022-11-01-preview/examples/Widgets_GetWidgetOperationStatusSample.json\u001B[22m\r\n    \u001B[2mspecification/contosowidgetmanager/data-plane/Azure.Contoso.WidgetManager/preview/2022-11-01-preview/examples/Widgets_CreateOrUpdateWidgetSample.json\u001B[22m\r\n    \u001B[2mspecification/contosowidgetmanager/data-plane/Azure.Contoso.WidgetManager/preview/2022-11-01-preview/examples/Widgets_DeleteWidgetSample.json\u001B[22m\r\n    \u001B[2mspecification/contosowidgetmanager/data-plane/Azure.Contoso.WidgetManager/preview/2022-11-01-preview/examples/Widgets_ListWidgetsSample.json\u001B[22m\r\n    \u001B[2mspecification/contosowidgetmanager/data-plane/Azure.Contoso.WidgetManager/stable/2022-12-01/widgets.json\u001B[22m\r\n    \u001B[2mspecification/contosowidgetmanager/data-plane/Azure.Contoso.WidgetManager/stable/2022-12-01/examples/Widgets_GetWidgetSample.json\u001B[22m\r\n    \u001B[2mspecification/contosowidgetmanager/data-plane/Azure.Contoso.WidgetManager/stable/2022-12-01/examples/Widgets_GetWidgetOperationStatusSample.json\u001B[22m\r\n    \u001B[2mspecification/contosowidgetmanager/data-plane/Azure.Contoso.WidgetManager/stable/2022-12-01/examples/Widgets_CreateOrUpdateWidgetSample.json\u001B[22m\r\n    \u001B[2mspecification/contosowidgetmanager/data-plane/Azure.Contoso.WidgetManager/stable/2022-12-01/examples/Widgets_DeleteWidgetSample.json\u001B[22m\r\n    \u001B[2mspecification/contosowidgetmanager/data-plane/Azure.Contoso.WidgetManager/stable/2022-12-01/examples/Widgets_ListWidgetsSample.json\u001B[22m\r\n\r\nCompilation completed successfully.\r\n\r\n- Compiling...\r\n\u001B[32m\u0393\u00A3\u00F6\u001B[39m Compiling\r\n- Running @azure-tools/typespec-autorest...\r\n\u001B[32m\u0393\u00A3\u00F6\u001B[39m @azure-tools/typespec-autorest \u001B[32m175ms\u001B[39m \u001B[2mspecification/contosowidgetmanager/\u001B[22m\r\n\r\nGenerated Swaggers:\r\nspecification\\contosowidgetmanager\\data-plane\\Azure.Contoso.WidgetManager\\preview\\2022-11-01-preview\\widgets.json\r\nspecification\\contosowidgetmanager\\data-plane\\Azure.Contoso.WidgetManager\\stable\\2022-12-01\\widgets.json\r\n\r\nOutput folder:\r\nspecification\\contosowidgetmanager\\data-plane\\Azure.Contoso.WidgetManager\r\n\r\nSwaggers matching output folder and filename:\r\nspecification\\contosowidgetmanager\\data-plane\\Azure.Contoso.WidgetManager\\preview\\2022-11-01-preview\\widgets.json\r\nspecification\\contosowidgetmanager\\data-plane\\Azure.Contoso.WidgetManager\\stable\\2022-12-01\\widgets.json\r\n\r\nSwaggers excluded via suppressions.yaml:\r\n\r\n\r\nRemaining swaggers:\r\nspecification\\contosowidgetmanager\\data-plane\\Azure.Contoso.WidgetManager\\preview\\2022-11-01-preview\\widgets.json\r\nspecification\\contosowidgetmanager\\data-plane\\Azure.Contoso.WidgetManager\\stable\\2022-12-01\\widgets.json\r\nTypeSpec compiler v1.2.1\r\n\r\n\r\nCompilation completed successfully.\r\n\r\nRunning git diff on folder C:/azure-rest-api-specs/specification/contosowidgetmanager\r\n\r\nExecuting rule: Format\r\nexecFile(\u0022C:\\nvm4w\\nodejs\\node.exe\u0022, [\u0022--\u0022,\u0022C:\\\\nvm4w\\\\nodejs\\\\node_modules\\\\npm\\\\bin\\\\npm-cli.js\u0022,\u0022exec\u0022,\u0022--no\u0022,\u0022--\u0022,\u0022tsp\u0022,\u0022format\u0022,\u0022../**/*.tsp\u0022])\r\nexecFile(\u0022C:\\nvm4w\\nodejs\\node.exe\u0022, [\u0022--\u0022,\u0022C:\\\\nvm4w\\\\nodejs\\\\node_modules\\\\npm\\\\bin\\\\npm-cli.js\u0022,\u0022exec\u0022,\u0022--no\u0022,\u0022--\u0022,\u0022prettier\u0022,\u0022--write\u0022,\u0022tspconfig.yaml\u0022])\r\n2025-10-23T00:24:58.380Z simple-git [GitExecutor] [SPAWN] git [ \u0027status\u0027, \u0027--porcelain\u0027, \u0027-b\u0027, \u0027-u\u0027, \u0027--null\u0027, \u0027--porcelain\u0027, \u0027C:/azure-rest-api-specs/specification/contosowidgetmanager\u0027 ]\r\n2025-10-23T00:24:58.573Z simple-git [GitExecutor] [HANDLE] retrieving task output complete\r\ntspconfig.yaml 25ms (unchanged)\r\nRunning git diff on folder C:/azure-rest-api-specs/specification/contosowidgetmanager\r\n\r\nExecuting rule: SdkTspConfigValidation\r\n[SdkTspConfigValidation]: validation passed.\r\n\r\n"]}""";

        public ChatMessage GetMockResponse(string callid)
        {
            return new ChatMessage(
                ChatRole.Tool,
                [
                    new FunctionResultContent(
                        callid,
                        toolResult
                    )
                ]
            );
        }

        public ChatMessage GetMockCall()
        {
            return new ChatMessage(
                ChatRole.Assistant,
                [
                    new FunctionCallContent(
                        CallId,
                        ToolName,
                        new Dictionary<string, object?>
                        {
                            { "typeSpecProjectRootPath", "C:\\azure-rest-api-specs\\specification\\contosowidgetmanager\\Contoso.WidgetManager" }
                        }
                    )
                ]
            );
        }
    }
}
