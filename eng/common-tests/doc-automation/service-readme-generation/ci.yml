# NOTE: Please refer to https://aka.ms/azsdk/engsys/ci-yaml before editing this file.
trigger:
  branches:
    include:
      - main
      - feature/*
      - release/*
      - hotfix/*
  paths:
    include:
      - eng/common/scripts/Service-Level-Readme-Automation.ps1
      - eng/common/scripts/Service-Level-Readme-Automation-Functions.ps1
      - eng/common/scripts/Helpers/Metadata-Helpers.ps1

pr:
  branches:
    include:
      - main
      - feature/*
      - release/*
      - hotfix/*
  paths:
    include:
      - eng/common/scripts/Service-Level-Readme-Automation.ps1
      - eng/common/scripts/Service-Level-Readme-Automation-Functions.ps1
      - eng/common/scripts/Helpers/Metadata-Helpers.ps1

stages:
  - stage: 'Test'
    jobs:
      - job: 'Test'

        strategy:
          matrix:
            Windows:
              Pool: 'azsdk-pool-mms-win-2019-general'
              Image: 'MMS2019'
            Linux:
              Pool: 'azsdk-pool-mms-ubuntu-2004-general'
              Image: 'MMSUbuntu20.04'
            Mac:
              Pool: 'Azure Pipelines'
              Image: 'macos-11'

        pool:
          name: $(Pool)
          vmImage: $(Image)

        steps:
          - template: /eng/pipelines/templates/steps/run-pester-tests.yml
            parameters:
              TargetDirectory: ${{ parameters.TargetDirectory }}
              CustomTestSteps: ${{ parameters.CustomTestSteps }}
              EnvVars: ${{ parameters.EnvVars }}
              TargetTags: ${{ parameters.TargetTags }}