parameters:
  - name: Environment
    type: string
  - name: WhatIf
    type: boolean
    default: true

jobs:
  - job:
    variables:
      - template: /eng/pipelines/templates/variables/globals.yml
    ${{ if eq(parameters.WhatIf, true) }}:
      displayName: 'Validate Provision'
    ${{ else }}:
      displayName: 'Provision'
    pool:
      name: 'azsdk-pool-mms-ubuntu-2004-general'
      vmImage: 'MMSUbuntu20.04'
    steps:
      - ${{ if eq(parameters.WhatIf, true) }}:
        - task: AzureCLI@2
          displayName: Validate Provision
          inputs:
            ${{ if eq(parameters.Environment, 'prod') }}:
              azureSubscription: Azure SDK Test Resources
            ${{ if eq(parameters.Environment, 'test') }}:
              azureSubscription: Azure SDK Playground
            scriptType: pscore
            scriptPath: $(System.DefaultWorkingDirectory)/tools/stress-cluster/cluster/provision.ps1
            arguments:
              -Environment ${{ parameters.Environment }}
              -WhatIf
      - ${{ else }}:
        - task: AzureCLI@2
          displayName: Provision
          inputs:
            ${{ if eq(parameters.Environment, 'prod') }}:
              azureSubscription: Azure SDK Test Resources
            ${{ if eq(parameters.Environment, 'test') }}:
              azureSubscription: Azure SDK Playground
            scriptType: pscore
            scriptPath: $(System.DefaultWorkingDirectory)/tools/stress-cluster/cluster/provision.ps1
            arguments:
              -Environment ${{ parameters.Environment }}
