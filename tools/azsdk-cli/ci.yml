# NOTE: Please refer to https://aka.ms/azsdk/engsys/ci-yaml before editing this file.
trigger:
  branches:
    include:
      - main
  paths:
    include:
      - tools/azsdk-cli

pr:
  branches:
    include:
      - main
  paths:
    include:
      - tools/azsdk-cli

variables:
  - name: ToolDir
    value: tools/azsdk-cli/Azure.Sdk.Tools.Cli

extends:
  template: /eng/pipelines/templates/stages/archetype-sdk-tool-dotnet.yml
  parameters:
    ${{ if eq(variables['Build.SourceBranchName'], 'main') }}:
      SkipReleaseStage: false
    PublishEnvironment: 'package-publish'
    ReleaseBinaries: true
    ToolDirectory: $(ToolDir)
    TestDirectory: tools/azsdk-cli/Azure.Sdk.Tools.Cli.Tests
    VerifyChangelog: true
    # GitHub.Copilot.SDK dependency is not strong name signed. Skip validation in order to sign azsdk cli.
    RequireStrongNames: false
    StandaloneExeMatrix:
      - rid: linux-x64
        framework: net8.0
        assembly: azsdk
      - rid: linux-arm64
        framework: net8.0
        assembly: azsdk
      - rid: osx-x64
        framework: net8.0
        assembly: azsdk
      - rid: osx-arm64
        framework: net8.0
        assembly: azsdk
      - rid: win-x64
        framework: net8.0
        assembly: azsdk
    ${{ if eq(variables['System.TeamProject'], 'internal') }}:
      CustomJobs:
      - template: /eng/common/pipelines/templates/jobs/ai-eval-job.yml
        parameters:
          EvalProject: tools/azsdk-cli/Azure.Sdk.Tools.Cli.Evaluations
          EvalRepoCommit: $(Build.SourceVersion)
          TargetRepoName: azure-rest-api-specs
          TargetRepoOwner: Azure
          TargetRepoCommit: main
      CustomReleaseJobs:
      - template: /tools/azsdk-cli/auto-documentation.yml
        parameters:
        ToolDirectory: $(ToolDir)

