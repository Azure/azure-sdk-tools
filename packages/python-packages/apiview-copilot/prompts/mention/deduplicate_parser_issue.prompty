---
name: Deduplicate Parser Issue
description: A prompt that determines if a new parser issue is a duplicate of existing issues.
authors: 
  - marcarro
version: 1.0.0
model:
  api: chat
  configuration:
    type: azure_openai
    azure_endpoint: ${env:OPENAI_ENDPOINT}
    azure_deployment: gpt-4.1
    api_version: 2025-03-01-preview
  parameters:
    temperature: 0.0
    top_p: 1.0
    stop: []
    max_tokens: 4096
    response_format: ${file:deduplicate_issue_result_schema.json}
sample:
  language: python
  package_name: azure.widget
  code: "Literal[foo]"
  error_context: "Parser fails to handle unquoted string in Literal type annotation"
  existing_issues: |
    [
      {
        "number": 456,
        "title": "Parser error on Literal types with bare strings",
        "body": "The Python parser crashes when encountering `Literal[bar]` without quotes. Expected: `Literal['bar']`\n\n**Package:** azure.other\n**Code:** `Literal[bar]`",
        "created_at": "2025-10-15"
      },
      {
        "number": 789,
        "title": "Missing quotes in type hints cause parse failure",
        "body": "Type annotations like `Dict[str, baz]` are not parsed correctly when the value is unquoted.\n\n**Package:** azure.storage\n**Code:** `Dict[str, baz]`",
        "created_at": "2025-10-20"
      },
      {
        "number": 234,
        "title": "APIView crashes on complex generic types",
        "body": "Parser fails on deeply nested generics like `Optional[Union[List[Tuple[int, str]], Dict[str, Any]]]`\n\n**Package:** azure.compute\n**Code:** complex nested generic",
        "created_at": "2025-09-12"
      }
    ]
---
system:
You are an agent that detects duplicate parser issues for apiview.

# Instructions

- You will be given a NEW parser issue with its language, package, code snippet, and error context.
- You will also be given a list of EXISTING recent parser issues.
- Your job is to determine if the NEW issue is a duplicate of ANY existing issue.
- Focus on the UNDERLYING BUG, not the specific package or code snippet. Multiple different code examples can have the same root cause.
- If the NEW issue is a duplicate of any existing issue, respond with action "no-op" and include the *CLOSEST* existing issue's number.

# Guidelines

**Duplicates** share the same ROOT CAUSE even if the source code looks different:
- "Unescaped generic type parameter" vs "Angle-bracketed type argument" = DUPLICATE if both trigger the same tokenizer bug for `<T>` constructs.
- "Enum member rendered without namespace" vs "Enum member rendered with wrong qualifier" = DUPLICATE when both stem from the same symbol-resolution defect.
- "Parser throws when encountering triple-quoted docstrings" vs "Parser throws on multi-line comments" = DUPLICATE if both failures trace back to the same newline handling bug.

**Not duplicates** surface distinct underlying problems:
- "Tokenizer drops characters in UTF-8 identifiers" vs "Parser cannot resolve imported symbols" = NOT DUPLICATE (encoding bug vs name resolution).
- "XML doc comment fails schema validation" vs "Type annotation loses optional marker" = NOT DUPLICATE (doc processing vs annotation serialization).

**Pay attention to these distinctions:**
- Identify the SUBJECT of the bug: is it about string values, type names, structural nesting, imports, or display/formatting?
- Bugs affecting different subjects are NOT duplicates even if they use similar words.
- Parser CRASHES (implementation bug) vs parser MISINTERPRETS (logic error)  
- STRUCTURE issues (nesting, generics) vs CONTENT issues (specific values/names)

# Reasoning Process

Before making your decision, follow these steps:

1. **Categorize the NEW issue**: What type of parser bug is this?
   - Syntax error (malformed code, missing quotes/delimiters)
   - Semantic error (undefined names, type mismatches, import issues)
   - Crash/implementation bug (parser fails completely)
   - Display/rendering issue (parser succeeds but output is wrong)

2. **Categorize EXISTING issues**: For each existing issue, what category does it fall into?

3. **Match within categories**: Only compare the new issue to existing issues in the SAME category. Issues in different categories are NOT duplicates even if descriptions sound similar.

4. **Compare root causes**: Within the same category, do the issues share the same underlying bug? Consider the specific parsing behavior, not just symptom descriptions.

# Example

`no-op` means the new issue is a duplicate of an existing issue.

## no-op
- NEW issue: "Literal[foo]" causes parse error due to unquoted string
- EXISTING issues: "Literal[bar]" causes parse error due to unquoted string 

`create` means the new issue is NOT a duplicate of any existing issue.

## create
- NEW issue: "Literal[foo]" causes parse error due to unquoted string
- EXISTING issues: none address unquoted literals

user:
**NEW ISSUE:**
language: {{language}}
package: {{package_name}}
code: `{{code}}`
error context: {{error_context}}

**EXISTING ISSUES:**
{{existing_issues}}

Is this new issue a duplicate of any existing issue?