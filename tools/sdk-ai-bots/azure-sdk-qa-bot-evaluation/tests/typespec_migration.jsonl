{"testcase": "Brownfield TypeSpec migration", "query": "title: Brownfield TypeSpec migration\n\nquestion: Hi, Is there a timeframe for existing brownfield RPs to move from OpenAPI swagger to TypeSpec.  Is it possible to mix TypeSpec with handwritten swagger and migrate in phases. Say for example migrate one resource type at a time to minimize risk.", "ground_truth": "Migration to TypeSpec for existing services is not yet mandatory, but it is suggested, and teams should be planning for it in Bromine and Krypton\nServices must wholly switch to TypeSpec, there is no allowed mixing of hand-written and generated swagger\nServicesmust conform to a single, unified api-version for their service, servicesthat currently use different api-versions for parts of their service are going to need to plan for conformance -this either means SDK splitting or version uniformity.  Teams that use this 'different api-versions for different resources in the same sdk' pattern are not good candidates for conversion at the moment\nIn generally, the more compliant your service is to the RPC and best practices, the easier conversion will be\nThere is documentation on converting here: [Getting started | TypeSpec Azure](https://azure.github.io/typespec-azure/docs/migrate-swagger/01-get-started/)", "expected_knowledges": [{"title": "Brownfield TypeSpec migration | question", "link": ""}, {"title": "What is TypeSpec?", "link": "https://eng.ms/docs/products/azure-developer-experience/design/api-specs/api-typespec"}, {"title": "Brownfield TypeSpec migration | answer", "link": ""}, {"title": "Convert OpenAPI specs to TypeSpec | Conversion process | Create a conversion plan", "link": "https://eng.ms/docs/products/azure-developer-experience/design/api-specs/api-typespec-conversion"}, {"title": "Convert OpenAPI specs to TypeSpec", "link": "https://eng.ms/docs/products/azure-developer-experience/design/api-specs/api-typespec-conversion"}, {"title": "OpenAPI3 to TypeSpec", "link": "https://typespec.io/docs/emitters/openapi3/cli"}, {"title": "Understanding the OpenAPI Changes", "link": "https://azure.github.io/typespec-azure/docs/migrate-swagger/faq/mustread"}, {"title": "Migrate data-plane specs", "link": "https://azure.github.io/typespec-azure/docs/migrate-swagger/checklists/migrate-dp-tips"}, {"title": "Modify/rename @resource(s) | question", "link": ""}, {"title": "After migration - in data-plane/DynamicSessions/tspconfig.yaml", "link": "https://github.com/Azure/azure-rest-api-specs/wiki/Resolving-Folder-Migration-Conflicts:-A-Guide-for-PR-Authors"}, {"title": "bad | `TypeSpec Requirement` check", "link": "https://eng.ms/docs/products/azure-developer-experience/design/specs-pr-guides/pr-suppressions"}, {"title": "TypeSpec for OpenAPI Developers | Data Types | type and format", "link": "https://typespec.io/docs/getting-started/typespec-for-openapi-dev"}, {"title": "Getting started with TypeSpec migration", "link": "https://azure.github.io/typespec-azure/docs/migrate-swagger/01-get-started"}, {"title": "Migrate ARM spec", "link": "https://azure.github.io/typespec-azure/docs/migrate-swagger/checklists/migrate-arm-tips"}, {"title": "Resolving OpenAPI Breaking Change Violations", "link": "https://azure.github.io/typespec-azure/docs/migrate-swagger/faq/breakingchange"}, {"title": "Resolving OpenAPI Breaking Change Violations", "link": "https://azure.github.io/typespec-azure/docs/migrate-swagger/faq/breakingchange"}, {"title": "Azure Service Versioning Guide | Splitting a Monolithic SDK Package into Service-Specific Packages", "link": "https://github.com/Azure/azure-rest-api-specs/wiki/Azure-Service-Versioning-Guideline"}, {"title": "Suppress validation failures on a PR | Suppression cases table", "link": "https://eng.ms/docs/products/azure-developer-experience/design/specs-pr-guides/pr-suppressions"}, {"title": "Suppress validation failures on a PR | suppressions.yaml", "link": "https://eng.ms/docs/products/azure-developer-experience/design/specs-pr-guides/pr-suppressions"}, {"title": "Validation Rule Suppression | Suppressing SdkTspConfigValidation Rules | Suppress Specific Sub-rules within SdkTspConfigValidation", "link": "https://github.com/Azure/azure-rest-api-specs/wiki/TypeSpec-Validation"}, {"title": "Introduction", "link": "https://azure.github.io/typespec-azure/docs/howtos/versioning/arm/01-about-versioning"}, {"title": "After migration - in data-plane/DynamicSessions/tspconfig.yaml", "link": "https://github.com/Azure/azure-rest-api-specs/wiki/Resolving-Folder-Migration-Conflicts:-A-Guide-for-PR-Authors"}, {"title": "Suppressing Failures", "link": "https://github.com/Azure/azure-rest-api-specs/wiki/TypeSpec-Requirement"}], "expected_references": [{"title": "What is TypeSpec?", "link": "https://eng.ms/docs/products/azure-developer-experience/design/api-specs/api-typespec"}, {"title": "Brownfield TypeSpec migration | answer", "link": ""}]}
{"testcase": "Unable to apply client flatten to a top level resource property.", "query": "title: Unable to apply client flatten to a top level resource property.\n\nquestion: my existing open api spec, of a proxy resource is such\n```\n\"ArcSetting\": {\n\"description\": \"ArcSetting details.\",\n\"type\": \"object\",\n\"allOf\": [\n{\n\"$ref\": \"../../../../../../common-types/resource-management/v5/types.json#/definitions/ProxyResource\"\n}\n],\n\"properties\": {\n\"properties\": {\n\"description\": \"ArcSetting properties.\",\n\"$ref\": \"#/definitions/ArcSettingProperties\",\n\"x-ms-client-flatten\": true\n}\n}\n},\n```\nTo convert it to typespec, here is what my tsp looks\n```\n/**\n* ArcSetting details.\n*/\n@parentResource(Cluster)\nmodel ArcSetting is Azure.ResourceManager.ProxyResource<ArcSettingProperties> {\n...ResourceNameParameter<\nResource = ArcSetting,\nKeyName = \"arcSettingName\",\nSegmentName = \"arcSettings\",\nNamePattern = \"\"\n>;\n}\n```\nthe output is missing, the client-flatten property\n```\n\"ArcSetting\": {\n\"type\": \"object\",\n\"description\": \"ArcSetting details.\",\n\"properties\": {\n\"properties\": {\n\"$ref\": \"#/definitions/ArcSettingProperties\",\n\"description\": \"ArcSetting properties.\"\n}\n},\n\"allOf\": [\n{\n\"$ref\": \"../../../../../../common-types/resource-management/v6/types.json#/definitions/ProxyResource\"\n}\n]\n},\n```\nIs there a possible way to add this flag, or what is the implication for the existing SDK", "ground_truth": "Add\n@@Azure.ClientGenerator.Core.Legacy.flattenProperty(ArcSettings.propeties)\nBy convention put this in a back-compatible.tsp file.", "expected_knowledges": [{"title": "Convert the Resource Model to a form without properties | answer", "link": "https://azure.github.io/typespec-azure/docs/migrate-swagger/faq/breakingchange"}, {"title": "SDK Validation steps are failing with not much helpful logs | answer", "link": ""}, {"title": "additional  \"x-ms-client-flatten\": true | answer", "link": "https://azure.github.io/typespec-azure/docs/migrate-swagger/faq/breakingchange"}, {"title": "additional  \"x-ms-client-flatten\": true | question", "link": "https://azure.github.io/typespec-azure/docs/migrate-swagger/faq/breakingchange"}, {"title": "Addendum | Designing Resources ##", "link": "https://github.com/cloud-and-ai-microsoft/resource-provider-contract/blob/master/v1.0/Addendum.md"}, {"title": "Put Resource # | Rules ## | General impact of violating the rules ###", "link": "https://github.com/cloud-and-ai-microsoft/resource-provider-contract/blob/master/v1.0/put-resource.md"}, {"title": "TypeSpec ARM Model Mapping to Swagger Documentation | 37. ProxyResource | TypeSpec Example", "link": ""}, {"title": "TypeSpec ARM Interface Mapping to Swagger Documentation | 7. ProxyResourceOperations | Swagger Output", "link": ""}, {"title": "TypeSpec ARM Decorator Mapping to Swagger Documentation | 21. @tenantResource | TypeSpec Example", "link": ""}, {"title": "Addendum | Designing Resources ##", "link": "https://github.com/cloud-and-ai-microsoft/resource-provider-contract/blob/master/v1.0/Addendum.md"}, {"title": "Usages for Illustrates the model flatten cases. | Scenario: Update and receive model with 1 level of flattening.", "link": "https://github.com/Azure/typespec-azure/blob/main/packages/azure-http-specs/specs/azure/client-generator-core/flatten-property/main.tsp"}, {"title": "Proxy API Reference | Proxy API reference ## | General impact of violating the rules ###", "link": "https://github.com/cloud-and-ai-microsoft/resource-provider-contract/blob/master/v1.0/proxy-api-reference.md"}, {"title": "SDK Validation steps are failing with not much helpful logs | question", "link": ""}, {"title": "Extend ResourceModelWithAllowedPropertySet | question", "link": ""}, {"title": "Understanding the OpenAPI Changes | Using Resources from Common Types", "link": "https://azure.github.io/typespec-azure/docs/migrate-swagger/faq/mustread"}, {"title": "Data types | Azure.ResourceManager.CommonTypes | `ResourceModelWithAllowedPropertySet` {#Azure.ResourceManager.CommonTypes.ResourceModelWithAllowedPropertySet}", "link": "https://azure.github.io/typespec-azure/docs/libraries/azure-resource-manager/reference/data-types"}, {"title": "Usages for Illustrates the model flatten cases. | Scenario: Update and receive model with 2 levels of flattening.", "link": "https://github.com/Azure/typespec-azure/blob/main/packages/azure-http-specs/specs/azure/client-generator-core/flatten-property/main.tsp"}, {"title": "bad | Suppress AutoRest extension | Obtain error code", "link": "https://eng.ms/docs/products/azure-developer-experience/design/specs-pr-guides/pr-suppressions"}, {"title": "Decorators | Azure.ClientGenerator.Core.Legacy | `@flattenProperty` {#@Azure.ClientGenerator.Core.Legacy.flattenProperty}", "link": "https://azure.github.io/typespec-azure/docs/libraries/typespec-client-generator-core/reference/decorators"}, {"title": "Usages for Illustrates the model flatten cases. | Scenario: Update and receive model with 1 level of flattening.", "link": "https://github.com/Azure/typespec-azure/blob/main/packages/azure-http-specs/specs/azure/client-generator-core/flatten-property/main.tsp"}, {"title": "Usages for Illustrates the model flatten cases. | Scenario: Update and receive model with 2 levels of flattening.", "link": "https://github.com/Azure/typespec-azure/blob/main/packages/azure-http-specs/specs/azure/client-generator-core/flatten-property/main.tsp"}, {"title": "TypeSpec PR Diff Validation Queries | answer", "link": ""}, {"title": "TypeSpec ARM Model Mapping to Swagger Documentation | 10. ArmLocationResource | Swagger Output", "link": ""}, {"title": "TypeSpec ARM Model Mapping to Swagger Documentation | 35. PrivateEndpointConnectionResource | Swagger Output", "link": ""}, {"title": "TypeSpec for OpenAPI Developers | Schema Object", "link": "https://typespec.io/docs/getting-started/typespec-for-openapi-dev"}, {"title": "no-openapi | Decorators and their alternatives", "link": "https://azure.github.io/typespec-azure/docs/libraries/azure-core/rules/no-openapi"}, {"title": "required;[\"id\", \"name\"]missing | question", "link": "https://azure.github.io/typespec-azure/docs/migrate-swagger/faq/breakingchange"}, {"title": "Operations | Metadata | Nested metadata", "link": "https://typespec.io/docs/libraries/http/operations"}], "expected_references": [{"title": "Decorators | Azure.ClientGenerator.Core.Legacy | @flattenProperty", "link": "https://azure.github.io/typespec-azure/docs/libraries/typespec-client-generator-core/reference/decorators"}, {"title": "no-openapi | Decorators and their alternatives", "link": "https://azure.github.io/typespec-azure/docs/libraries/azure-core/rules/no-openapi"}, {"title": "additional  \"x-ms-client-flatten\": true | answer", "link": "https://azure.github.io/typespec-azure/docs/migrate-swagger/faq/breakingchange"}, {"title": "TypeSpec ARM Model Mapping to Swagger Documentation | 37. ProxyResource | TypeSpec Example", "link": ""}]}
