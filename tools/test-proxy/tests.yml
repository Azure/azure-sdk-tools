trigger: none

variables:
  - template: /eng/pipelines/templates/variables/globals.yml

stages:
  - stage: IntegrationTests
    displayName: "Asset Sync Integration Tests"
    jobs:
    - job: Solution_Integration_Test

      strategy:
        matrix:
          Windows:
            Pool: 'azsdk-pool'
            OS: 'Windows'
            Image: 'windows-2022'
          Linux:
            Pool: 'azsdk-pool'
            OS: 'Linux'
            Image: "ubuntu-24.04"

      pool:
        name: $(Pool)
        demands: ImageOverride -equals $(Image)

        # we are ok with default image on each

      steps:
        - template: pipelines/proxy-solution-integration-tests.yml

    - job: Solution_Integration_Test_Macs

      pool:
        name: 'Azure Pipelines'
        vmImage: "macos-latest"

      steps:
        - template: pipelines/proxy-solution-integration-tests.yml

    - job: CLI_Integration_Test
      strategy:
        matrix:
          Windows:
            Pool: 'azsdk-pool'
            OS: 'Windows'
            Image: 'windows-2022'
          Linux:
            Pool: 'azsdk-pool'
            OS: 'Linux'
            Image: "ubuntu-24.04"

      pool:
        name: $(Pool)
        demands: ImageOverride -equals $(Image)

      steps:
        - template: pipelines/proxy-cli-integration-tests.yml

    - job: CLI_Integration_Test

      pool:
        name: 'Azure Pipelines'
        vmImage: 'macos-latest'

      steps:
        - template: pipelines/proxy-cli-integration-tests.yml

  - stage: RepoUnitTests
    displayName: Repo-Specific Unit Tests
    dependsOn: []
    jobs:
    - job: Test_JS_Utils

      displayName: Invoke JS Utils CI Tests

      strategy:
        matrix:
          Windows:
            Pool: 'azsdk-pool'
            OS: 'Windows'
            Image: 'windows-2022'
          Linux:
            Pool: 'azsdk-pool'
            OS: 'Linux'
            Image: "ubuntu-24.04"

      pool:
        name: $(Pool)
        demands: ImageOverride -equals $(Image)

      variables:
        REPO: "Azure/azure-sdk-for-js"
        CLONE_LOCATION: "$(Agent.BuildDirectory)/js_repo"

      steps:
        - template: pipelines/js-integration-tests.yml
          parameters:
            REPO: $(REPO)
            CLONE_LOCATION: $(CLONE_LOCATION)

    - job: Test_JS_Utils_Mac

      displayName: Invoke JS Utils CI Tests

      pool:
        name: 'Azure Pipelines'
        vmImage: 'macos-latest'

      variables:
        REPO: "Azure/azure-sdk-for-js"
        CLONE_LOCATION: "$(Agent.BuildDirectory)/js_repo"

      steps:
        - template: pipelines/js-integration-tests.yml
          parameters:
            REPO: $(REPO)
            CLONE_LOCATION: $(CLONE_LOCATION)

    - job: Test_Net_Core

      displayName: Invoke .NET Azure.Core.Testframework CI Tests

      strategy:
        matrix:
          Windows:
            Pool: 'azsdk-pool'
            OS: 'Windows'
            Image: 'windows-2022'
          Linux:
            Pool: 'azsdk-pool'
            OS: 'Linux'
            Image: "ubuntu-24.04"

      pool:
        name: $(Pool)
        demands: ImageOverride -equals $(Image)

      variables:
        REPO: "Azure/azure-sdk-for-net"
        CLONE_LOCATION: "$(Agent.BuildDirectory)/net_repo"

      steps:
        - template: pipelines/net-integration-tests.yml
          parameters:
            REPO: $(REPO)
            CLONE_LOCATION: $(CLONE_LOCATION)

    - job: Test_Net_Core_Mac

      displayName: Invoke .NET Azure.Core.Testframework CI Tests for Mac

      pool:
        name: 'Azure Pipelines'
        vmImage: 'macos-latest'

      variables:
        REPO: "Azure/azure-sdk-for-net"
        CLONE_LOCATION: "$(Agent.BuildDirectory)/net_repo"

      steps:
        - template: pipelines/net-integration-tests.yml
          parameters:
            REPO: $(REPO)
            CLONE_LOCATION: $(CLONE_LOCATION)

    - job: Test_Python_Tables
      displayName: Run Python Tables CI Tests

      strategy:
        matrix:
          Windows:
            Pool: 'azsdk-pool'
            OS: 'Windows'
            Image: 'windows-2022'
          Linux:
            Pool: 'azsdk-pool'
            OS: 'Linux'
            Image: "ubuntu-24.04"

      pool:
        name: $(Pool)
        demands: ImageOverride -equals $(Image)

      variables:
        REPO: "Azure/azure-sdk-for-python"
        CLONE_LOCATION: "$(Agent.BuildDirectory)/python_repo"

      steps:
        - template: pipelines/python-integration-tests.yml
          parameters:
            REPO: $(REPO)
            CLONE_LOCATION: $(CLONE_LOCATION)

    - job: Test_Python_Tables_Mac
      displayName: Run Python Tables CI Tests
      pool:
        name: 'Azure Pipelines'
        vmImage: 'macos-latest'

      variables:
        REPO: "Azure/azure-sdk-for-python"
        CLONE_LOCATION: "$(Agent.BuildDirectory)/python_repo"

      steps:
        - template: pipelines/python-integration-tests.yml
          parameters:
            REPO: $(REPO)
            CLONE_LOCATION: $(CLONE_LOCATION)

    - job: Test_Java_Core

      displayName: Run Java Core Local Tests

      strategy:
        matrix:
          Windows:
            Pool: 'azsdk-pool'
            OS: 'Windows'
            Image: 'windows-2022'

      pool:
        name: $(Pool)
        demands: ImageOverride -equals $(Image)

      variables:
        REPO: "Azure/azure-sdk-for-java"
        CLONE_LOCATION: "$(Agent.BuildDirectory)/java_repo"

      steps:
        - template: pipelines/java-integration-tests.yml
          parameters:
            REPO: $(REPO)
            CLONE_LOCATION: $(CLONE_LOCATION)
