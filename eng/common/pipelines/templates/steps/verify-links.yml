parameters:
  Directory: 'not-specified'
  IgnoreLinksFile: "$(Build.SourcesDirectory)/eng/ignore-links.txt"
  WorkingDirectory: $(System.DefaultWorkingDirectory)
  ScriptDirectory: eng/common/scripts
steps:
  - task: PowerShell@2
    displayName: Link verification check
    inputs:
      pwsh: true
      workingDirectory: "${{ parameters.WorkingDirectory }}/${{ parameters.Directory }}"
      filePath: ${{ parameters.ScriptDirectory }}/Verify-Links.ps1
      arguments: >
        -urls $(dir -r -i *.md) 
        -rootUrl "file://$(Build.SourcesDirectory)/${{ parameters.Directory }}" 
        -recursive: $false 
        -ignoreLinksFile ${{ parameters.IgnoreLinksFile }}
        -branchReplaceRegex "^($env:SYSTEM_PULLREQUEST_SOURCEREPOSITORYURI.*/(?:blob|tree)/)master(/.*)$"
        -branchReplacementName $env:SYSTEM_PULLREQUEST_SOURCECOMMITID
        -devOpsLogging: $true
        -checkLinkGuidance: $true
