name: Validate LLM Instructions Files

on:
  push:
    branches:
      - main
    paths:
      - 'eng/common/instructions/**'
      - 'tools/azsdk-cli/Azure.Sdk.Tools.Cli/Tools/**'
      - 'eng/scripts/Verify-McpToolReferences.ps1'
      - '.github/workflows/instructions.yml'
  pull_request:
    paths:
      - 'eng/common/instructions/**'
      - 'tools/azsdk-cli/Azure.Sdk.Tools.Cli/Tools/**'
      - 'eng/scripts/Verify-McpToolReferences.ps1'
      - '.github/workflows/instructions.yml'

jobs:
  verify-mcp-tools:
    name: Verify MCP Tool References
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6

      - uses: actions/setup-dotnet@v5
        with:
          dotnet-version: |
            8.0.x
            9.0.x

      # Ignore the azure-sdk nuget package mirror
      # that github actions cannot access by default
      - name: disable nuget mirror
        shell: pwsh
        run: |
          dotnet nuget disable source azure-sdk-for-net
          dotnet nuget add source https://api.nuget.org/v3/index.json -n nuget.org

      - name: azsdk-cli verify
        shell: pwsh
        run: |
          ./eng/scripts/Verify-McpToolReferences.ps1 `
            -InstructionsPath ./eng/common/instructions/azsdk-tools
