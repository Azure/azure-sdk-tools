parameters:
- name: BuildStages
  type: object
  default: []
- name: BuildStageName
  type: string
  default: ''
- name: ArtifactName
  type: string
  default: ''
- name: PackageJsonPath
  type: string
  default: ''


extends:
  template: /eng/pipelines/templates/stages/1es-redirect.yml
  parameters:
    GenerateBaselines: true
    stages:
      - ${{ parameters.BuildStages }}

      # only include if running on `internal` build with manual queue, otherwise never include
      - ${{ if and(in(variables['Build.Reason'], 'Manual', ''), eq(variables['System.TeamProject'], 'internal'))}}:
        - stage: Publish
          displayName: Publish
          dependsOn: ${{ parameters.BuildStageName }}

          jobs:
            - template: /eng/common/pipelines/templates/jobs/npm-release-task.yml
              parameters:
                Artifact:
                  name: ${{ replace( parameters.ArtifactName, '-', '_') }}
                  path: $(Pipeline.Workspace)/${{ parameters.ArtifactName }}
                PathToArtifacts: $(Pipeline.Workspace)/${{ parameters.ArtifactName }}
                Registry: 'https://registry.npmjs.org/'
                TopLevelArtifactName: ${{ parameters.ArtifactName }}
                varDependencies:
                  - key: Tag
                    value: "beta"
