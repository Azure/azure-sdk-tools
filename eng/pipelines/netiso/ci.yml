jobs:
  - job: testnetiso
    pool:
      name: bebroder-test-netiso
    displayName: test-netiso
    steps:
      - checkout: self
      - task: AzureCLI@2
        displayName: NetIso
        inputs:
          azureSubscription: azure-sdk-tests
          azurePowerShellVersion: LatestVersion
          scriptType: pscore
          scriptLocation: inlineScript
          inlineScript: |
            $GROUP = "bebroder-test-netiso-open-2"
            $ACCOUNT = "bebrodernetisoopen2"
            $CONTAINER = "test"
            $BLOB = "test"
            Write-Host "Getting key for open account"
            $KEY = az storage account keys list --resource-group $GROUP --account-name $ACCOUNT --query '[0].value' -o tsv
            Write-Host "Downloading blob from open account"
            az storage blob download  --account-name $ACCOUNT --account-key $KEY --container-name $CONTAINER --file testdataopen --name $BLOB -o tsv
            Write-Host "Printing data from open account"
            cat testdataopen
            $GROUP = "bebroder-test-netiso-closed-2"
            $ACCOUNT = "bebrodernetisoclosed2"
            Write-Host "Getting key from net iso account"
            $KEY = az storage account keys list --resource-group $GROUP --account-name $ACCOUNT --query '[0].value' -o tsv
            Write-Host "Downloading blob from net iso account"
            az storage blob download  --account-name $ACCOUNT --account-key $KEY --container-name $CONTAINER --file testdata --name $BLOB -o tsv
            Write-Host "Printing data from net iso account"
            cat testdata
