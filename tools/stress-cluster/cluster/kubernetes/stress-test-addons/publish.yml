trigger: none
pr: none

extends:
  template: /eng/pipelines/templates/stages/1es-redirect.yml
  parameters:
    stages:
      - stage:
        displayName: Publish addons helm chart
        jobs:
          - job:
            displayName: Publish addons helm chart
            pool:
              name: azsdk-pool-mms-ubuntu-2204-general
              vmImage: ubuntu-22.04
              os: linux

            steps:
              - task: AzureCLI@2
                displayName: Publish addons helm chart
                inputs:
                  azureSubscription: 'Azure SDK Artifacts'
                  scriptPath: tools/stress-cluster/cluster/kubernetes/stress-test-addons/deploy.ps1
                  scriptType: pscore
                  arguments: '-Force'

              - template: /eng/common/pipelines/templates/steps/create-pull-request.yml
                parameters:
                  PRBranchName: "stress/addons-helm-update"
                  CommitMsg: "[stress] Updating helm chart index.yaml file for new stress-test-addons release"
                  PRTitle: "[stress] Updating helm chart index.yaml file for new stress-test-addons release"
