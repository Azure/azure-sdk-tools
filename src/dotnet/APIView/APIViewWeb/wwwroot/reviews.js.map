{"version":3,"file":"reviews.js","mappings":"yBAAAA,GAAE,KAEA,MACMC,EAAuBD,EAAG,2BAC1BE,EAAiBF,EAAG,sCACpBG,EAAYH,EAAG,kCACfI,EAAcJ,EAAG,mCACjBK,EAAeL,EAAG,oCAClBM,EAAaN,EAAG,kCAEhBO,EAAYP,EAAE,6BACdQ,EAAgBR,EAAE,gBAQxB,SAASS,GAAoB,OAAEC,EAAS,EAAC,SAAEC,EAjBnB,GAiB6C,UAAEC,EAAY,OAAM,OAAEC,EAAS,IAAO,IAEzG,IAAIC,EAAM,0BAEI,MAAVD,GAAmC,IAAjBA,EAAOE,QAETF,EAAOE,OAAOC,MAAM,OAC1BC,SAAQ,SAASC,EAAOC,GAClCL,EAAMA,EAAM,WAAaM,mBAAmBF,MAIhDhB,EAAemB,SAAS,aAAaC,MAAK,WACxCR,EAAMA,EAAM,cAAgBM,mBAAmB,GAAGpB,EAAEuB,MAAMC,YAG5DrB,EAAUkB,SAAS,aAAaC,MAAK,WACnCR,EAAMA,EAAM,SAAWM,mBAAmB,GAAGpB,EAAEuB,MAAMC,YAGvDpB,EAAYiB,SAAS,aAAaC,MAAK,WACrCR,EAAMA,EAAM,UAAYM,mBAAmB,GAAGpB,EAAEuB,MAAMC,YAGxDnB,EAAagB,SAAS,aAAaC,MAAK,WACtCR,EAAMA,EAAM,WAAaM,mBAAmB,GAAGpB,EAAEuB,MAAMC,YAGzDlB,EAAWe,SAAS,aAAaC,MAAK,WACpCR,EAAMA,EAAM,SAAWM,mBAAmB,GAAGpB,EAAEuB,MAAMC,YAKvDV,GADAA,GADAA,EAAMA,EAAM,WAAaM,mBAAmBV,IAChC,aAAeU,mBAAmBT,IAClC,cAAgBS,mBAAmBR,GAC/CE,EAAMW,UAAUX,GAEhBd,EAAE0B,KAAK,CACLC,IAAKb,IACJc,MAAK,SAASC,GACf5B,EAAqB6B,KAAKD,GAC1BE,QAAQC,UAAU,GAAI,GAAIlB,EAAImB,QAAQ,0BAA2B,KACjEC,OAKJ,SAASA,IAEPlC,EAAG,cAAesB,MAAK,WACrBtB,EAAEuB,MAAMY,GAAG,SAAS,SAASC,GAC3BA,EAAMC,iBACN,IAAIC,EAAYtC,EAAEuB,MAAMgB,KAAK,QAAQvB,MAAM,KACvCN,EAAS4B,EAAUA,EAAUE,OAAS,GACtC9B,MAAAA,GAEFD,EAAoB,CAAEC,OAAQA,UAOtC,SAAS+B,EAAqBC,EAAQC,GAGpC,IAAI7B,EAAM,mBAAmB6B,IACzBC,EAAY,IAAIC,gBAAgBC,SAASjC,QACzC+B,EAAUG,IAAIJ,IAEhBC,EAAUI,OAAOL,GAAO1B,SAAQ,SAASC,EAAOC,GAC9CL,EAAMA,EAAM,YAAY6B,KAAWvB,mBAAmBF,MAG1DlB,EAAE0B,KAAK,CACLC,IAAKb,IACJc,MAAK,SAASC,GACfa,EAAOZ,KAAKD,GACNa,EAAQO,aAAa,cAnFzBjD,EAAE,2BAA4BkD,UAmGpClD,EAAEmD,UAAUC,OAAM,WAChBX,EAAqBtC,EAAW,QAChCsC,EAAqBvC,EAAgB,aACrCgC,OAKF,CAAChC,EAAgBC,EAAWC,EAAaC,EAAcC,GAAYW,SAAQ,SAASC,EAAOC,GACzFD,EAAMiB,GAAG,oBAAoB,WAC3B1B,UAKAF,EAAUiB,OA3Bd,WAEE,MAAM6B,EAAc9C,EAAUiB,MAAiB8B,cAC/C9C,EAAc+C,QAAQ,MAAMC,YAAY,cAAcC,SACtDjD,EAAckD,KAAKL,EAAY,CAC7BzB,KAAM,WACJpB,EAAcmD,IAAI,cAAcJ,QAAQ,MAAMK,SAAS,iBAsB3DC,GAGFtD,EAAU4B,GAAG,YAAY,SAAS2B,GACnB,SAATA,EAAEC,KAAqC,MAAnBxD,EAAUiB,OAEhCf,EAAoB,CAAEI,OAASN,EAAUiB,c","sources":["webpack://apiview/./src/reviews.ts"],"sourcesContent":["$(() => {\r\n  // Search\r\n  const defaultPageSize = 50;\r\n  const reviewsFilterPartial = $( '#reviews-filter-partial' );\r\n  const languageFilter = $( '#language-filter-bootstraps-select' );\r\n  const tagFilter = $( '#tags-filter-bootstraps-select' );\r\n  const stateFilter = $( '#state-filter-bootstraps-select' );\r\n  const statusFilter = $( '#status-filter-bootstraps-select' );\r\n  const typeFilter = $( '#type-filter-bootstraps-select' );\r\n\r\n  const searchBox = $('#reviews-table-search-box');\r\n  const searchContext = $('.review-name') as any;\r\n\r\n  // Enable tooltip\r\n  (<any>$('[data-toggle=\"tooltip\"]')).tooltip();\r\n\r\n  // Computes the uri string using the values of search, pagination and various filters\r\n  // Invokes partial page update to list of reviews using ajax\r\n  // Updates the uri displayed on the client\r\n  function updateListedReviews({ pageNo = 1, pageSize = defaultPageSize, sortField = \"Name\", search = \"\" } = {})\r\n  {\r\n    var uri = '?handler=reviewspartial';\r\n\r\n    if (search != null && search.trim() != '')\r\n    {\r\n      var searchTerms = search.trim().split(/\\s+/);\r\n      searchTerms.forEach(function(value, index){\r\n        uri = uri + '&search=' + encodeURIComponent(value);\r\n      });\r\n    }\r\n\r\n    languageFilter.children(\":selected\").each(function() {\r\n      uri = uri + '&languages=' + encodeURIComponent(`${$(this).val()}`);\r\n    });\r\n\r\n    tagFilter.children(\":selected\").each(function() {\r\n      uri = uri + '&tags=' + encodeURIComponent(`${$(this).val()}`);\r\n    });\r\n    \r\n    stateFilter.children(\":selected\").each(function() {\r\n      uri = uri + '&state=' + encodeURIComponent(`${$(this).val()}`);\r\n    });\r\n\r\n    statusFilter.children(\":selected\").each(function() {\r\n      uri = uri + '&status=' + encodeURIComponent(`${$(this).val()}`);\r\n    });\r\n\r\n    typeFilter.children(\":selected\").each(function() {\r\n      uri = uri + '&type=' + encodeURIComponent(`${$(this).val()}`);\r\n    });\r\n\r\n    uri = uri + '&pageNo=' + encodeURIComponent(pageNo);\r\n    uri = uri + '&pageSize=' + encodeURIComponent(pageSize);\r\n    uri = uri + '&sortField=' + encodeURIComponent(sortField);\r\n    uri = encodeURI(uri);\r\n\r\n    $.ajax({\r\n      url: uri\r\n    }).done(function(partialViewResult) {\r\n      reviewsFilterPartial.html(partialViewResult);\r\n      history.pushState({}, '', uri.replace('handler=reviewspartial&', ''));\r\n      addPaginationEventHandlers(); // This ensures that the event handlers are re-added after ajax refresh\r\n    });\r\n  }\r\n\r\n  // Add custom behaviour and event to pagination buttons\r\n  function addPaginationEventHandlers()\r\n  {\r\n    $( '.page-link' ).each(function() {\r\n      $(this).on('click', function(event){\r\n        event.preventDefault();\r\n        var linkParts = $(this).prop('href').split('/');\r\n        var pageNo = linkParts[linkParts.length - 1];\r\n        if (pageNo !== null && pageNo !== undefined)\r\n        {\r\n          updateListedReviews({ pageNo: pageNo });\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  // Triggers partial page update to retriev properties for poulating filter dropdowns\r\n  function updateFilterDropDown(filter, query)\r\n  {\r\n    // update tags dropdown select\r\n    var uri = `?handler=reviews${query}`;\r\n    var urlParams = new URLSearchParams(location.search);\r\n    if (urlParams.has(query))\r\n    {\r\n      urlParams.getAll(query).forEach(function(value, index) {\r\n        uri = uri + `&selected${query}=` + encodeURIComponent(value);\r\n      });\r\n    }\r\n    $.ajax({\r\n      url: uri\r\n    }).done(function(partialViewResult) {\r\n      filter.html(partialViewResult);\r\n      (<any>filter).selectpicker('refresh');\r\n    });\r\n  }\r\n\r\n  function filterReviews(){\r\n    // highlight matching text using mark.js framework and hide rows that don't match\r\n    const searchText = (searchBox.val() as string).toUpperCase();\r\n    searchContext.closest('tr').removeClass('hidden-row').unmark();\r\n    searchContext.mark(searchText, {\r\n      done: function () {\r\n        searchContext.not(':has(mark)').closest('tr').addClass('hidden-row');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Update content of dropdown on page load\r\n  $(document).ready(function() {\r\n    updateFilterDropDown(tagFilter, \"tags\");\r\n    updateFilterDropDown(languageFilter, \"languages\");\r\n    addPaginationEventHandlers();\r\n  });\r\n\r\n\r\n  // Update when any dropdown is changed\r\n  [languageFilter, tagFilter, stateFilter, statusFilter, typeFilter].forEach(function(value, index) {\r\n    value.on('hidden.bs.select', function() {\r\n      updateListedReviews();\r\n    });\r\n  });\r\n\r\n  // If already populated from navigating back, filter again\r\n  if (searchBox.val()) {\r\n    filterReviews();\r\n  }\r\n\r\n  searchBox.on('keypress', function(e) {\r\n    if (e.key == \"Enter\" && searchBox.val() != null)\r\n    {\r\n      updateListedReviews({ search : searchBox.val() as string });\r\n    }\r\n  });\r\n});\r\n"],"names":["$","reviewsFilterPartial","languageFilter","tagFilter","stateFilter","statusFilter","typeFilter","searchBox","searchContext","updateListedReviews","pageNo","pageSize","sortField","search","uri","trim","split","forEach","value","index","encodeURIComponent","children","each","this","val","encodeURI","ajax","url","done","partialViewResult","html","history","pushState","replace","addPaginationEventHandlers","on","event","preventDefault","linkParts","prop","length","updateFilterDropDown","filter","query","urlParams","URLSearchParams","location","has","getAll","selectpicker","tooltip","document","ready","searchText","toUpperCase","closest","removeClass","unmark","mark","not","addClass","filterReviews","e","key"],"sourceRoot":""}