trigger:
  branches:
    include:
      - main
  paths:
    include:
      - tools/spec-gen-sdk

pr:
  branches:
    include:
      - main
  paths:
    include:
      - tools/spec-gen-sdk

parameters:
  - name: Publish
    type: boolean
    default: false

extends:
  template: /eng/pipelines/templates/stages/archetype-sdk-publish-js.yml
  parameters:
    BuildStageName: InstallAndBuild
    ArtifactName: drop
    PackageJsonPath: $(Build.SourcesDirectory)/tools/spec-gen-sdk
    BuildStages:
      - stage: InstallAndBuild
        variables:
          - template: /eng/pipelines/templates/variables/globals.yml
          - template: /eng/pipelines/templates/variables/image.yml
          - name: NodeVersion
            value: '20.x'
          - name: VAR_ARTIFACT_NAME
            value: 'drop'
          - name: VAR_BUILD_ARTIFACT_STAGING_DIRECTORY
            value: $(Build.ArtifactStagingDirectory)
        jobs:
          - job: Build_Linux
            pool:
              name: $(LINUXPOOL)
              image: $(LINUXVMIMAGE)
              os: linux
            steps:
              - template: /tools/spec-gen-sdk/build-spec-gen-sdk.yml
                parameters:
                  Publish: $(Publish)