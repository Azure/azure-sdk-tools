
<p-contextMenu #cm [model]="contextMenuItems"></p-contextMenu>
<p-table
    [value]="reviews"
    dataKey="id"
    [scrollable]="true"
    scrollHeight="calc(100vh - 180px)"
    responsiveLayout="stack"
    [lazy]="true"
    [lazyLoadOnInit]="false"
    [virtualScroll]="true"
    [virtualScrollDelay]="0"
    [virtualScrollItemSize]="49"
    [(contextMenuSelection)]="selectedReview"
    [contextMenu]="cm"
    [customSort]="true"
    (onLazyLoad)="onLazyLoad($event)"
    (onSort)="onSort($event)"
    (onFilter)="onFilter($event)"
    [tableStyle]="{ 'min-width': '10rem' }"
    styleClass="p-datatable-sm">
    <ng-template pTemplate="caption">
        <div class="d-flex justify-content-between index-table-info">
            <div>
                <p-chip *ngFor="let lang of selectedLanguages" label="{{ lang.data }}"></p-chip>
                <p-chip *ngFor="let dts of selectedDetails" label="{{ dts.data }}"></p-chip>
            </div>
            <div>
                <button *ngIf="showSelectionAction" type="button" class="btn btn-sm btn-outline-primary me-1"><i class="bi bi-x-circle me-1"></i>Close</button>
                <button *ngIf="showSelectionAction" type="button" class="btn btn-sm btn-outline-primary me-1"><i class="bi bi-x-circle me-1"></i>Subscribe</button>
                <button *ngIf="showSelectionAction" type="button" class="btn btn-sm btn-outline-danger me-1"><i class="bi bi-x-octagon-fill me-1"></i>Delete</button>
                <button *ngIf="showSelectionAction" type="button" class="btn btn-sm btn-outline-primary me-1"><i class="bi bi-x-circle me-1"></i>Selection</button>
                <button type="button" class="btn btn-sm btn-outline-primary"><i class="bi bi-x-circle me-1"></i>Filters</button>
            </div>
        </div>
    </ng-template>
    <ng-template pTemplate="header">
        <tr>
            <th style="width:2%">Lanuage</th>
            <th pSortableColumn="name" style="width:60%">Review<p-sortIcon class="ms-2" field="name"></p-sortIcon></th>
            <th style="width:auto">Details</th>
        </tr>
        <tr>
            <th>
                <p-columnFilter id="langauge-filter" field="languages" matchMode="in" [showMenu]="false">
                    <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                        <p-multiSelect [ngModel]="value" [options]="languages" [filter]="false" [(ngModel)]="selectedLanguages" (onChange)="filter($event.value)" optionLabel="label">
                            <ng-template let-option pTemplate="item">
                                <div class="inline-block vertical-align-middle">
                                    <img [alt]="" src="assets/images/{{ option.label | languageNames }}-original.svg" width="24" class="vertical-align-middle" />
                                    <span class="mx-2 mt-1">{{ option.label }}</span>
                                </div>
                            </ng-template>
                        </p-multiSelect>
                    </ng-template>
                </p-columnFilter>
            </th>
            <th>
                <p-columnFilter type="text" field="name" [showMenu]="false"></p-columnFilter>
            </th>
            <th>
                <p-columnFilter id="details-filter" field="details" matchMode="in" [showMenu]="false">
                    <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                        <p-multiSelect [ngModel]="value" 
                        [options]="details" [group]="true" [filter]="false" 
                        [(ngModel)]="selectedDetails" (onChange)="filter($event.value)" 
                        optionLabel="label" scrollHeight="500px">
                            <ng-template let-group pTemplate="group">
                                <div class="inline-block vertical-align-middle">
                                    <span class="ml-1 mt-1">{{ group.label }}</span>
                                </div>
                            </ng-template>
                        </p-multiSelect>
                    </ng-template>
                </p-columnFilter>
            </th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-review>
        <tr [pContextMenuRow]="review">
            <td>
                <p-button icon="pi pi-folder-open" styleClass="p-button-rounded p-button-text p-button-secondary"></p-button>
                <img class="float-end" src="assets/images/{{ review.language | languageNames }}-original.svg" alt="{{review.language}}" width="30">
            </td>
            <td style="word-wrap: break-word; max-width: 10ch">{{ review.packageName }}</td>
            <td>
                <i pTooltip="{{ review.status }}" appendTo="target" tooltipPosition="top" [positionTop]=-200 [positionLeft]=-25 class="{{ badgeClass.get(review.status) }} me-2"></i>
                <i pTooltip="{{ review.state }}" appendTo="target" tooltipPosition="top" [positionTop]=-200 [positionLeft]=-25 class="{{ badgeClass.get(review.state) }} me-2"></i>
            </td>
        </tr>
    </ng-template>
    <ng-template pTemplate="summary">
        <div class="flex align-items-center justify-content-center">
            {{first }} - {{last}} of {{totalNumberOfReviews}}
        </div>
    </ng-template>
</p-table>
<button type="button" (click)="sidebarVisible = true" class="btn btn-primary" id="create-review-button"><small>CREATE</small><br><i class="fas fa-plus"></i><br><small>REVIEW</small></button>
<p-sidebar [(visible)]="sidebarVisible" position="right">
    <h3>Create Review</h3>
    <p>
        Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. 
        Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
    </p>
    <p-dropdown [options]="languages" [(ngModel)]="selectedCRLanguages" optionLabel="label"></p-dropdown>
    <p-fileUpload mode="basic" chooseLabel="Select Review File" name="demo[]" url="https://www.primefaces.org/cdn/api/upload.php" accept="image/*"></p-fileUpload>

</p-sidebar>
