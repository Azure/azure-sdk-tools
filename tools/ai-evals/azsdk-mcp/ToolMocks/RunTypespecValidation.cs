using Microsoft.Extensions.AI;

namespace Azure.Sdk.Tools.McpEvals.ToolMocks
{
    public class RunTypespecValidation : IToolMock
    {
        public string ToolName => "azsdk_run_typespec_validation";
        public string CallId => "tooluse_E4IlmABTSvaVU4YrPH6F";
        private string toolResult => """
            {"result":["Running TypeSpecValidation on folder:  C:/Users/juanospina/source/repos/azure-rest-api-specs/specification/contosowidgetmanager/Contoso.WidgetManager\r\n\r\nExecuting rule: FolderStructure\r\n2025-10-21T21:19:41.849Z simple-git [GitExecutor] [SPAWN] git [ \u0027rev-parse\u0027, \u0027--show-toplevel\u0027 ]\r\n2025-10-21T21:19:41.925Z simple-git [GitExecutor] [HANDLE] retrieving task output complete\r\nfolder: C:/Users/juanospina/source/repos/azure-rest-api-specs/specification/contosowidgetmanager/Contoso.WidgetManager\r\nconfig files: [\u0022C:/Users/juanospina/source/repos/azure-rest-api-specs/specification/contosowidgetmanager/Contoso.WidgetManager/tspconfig.yaml\u0022]\r\nazure-resource-provider-folder: \u0022data-plane\u0022\r\nimports:\r\n  specification\\contosowidgetmanager\r\n    Contoso.Management/employee.tsp: []\r\n    Contoso.Management/main.tsp: [\u0022./employee.tsp\u0022]\r\n    Contoso.WidgetManager/client.tsp: [\u0022./main.tsp\u0022]\r\n    Contoso.WidgetManager/main.tsp: [\u0022../Contoso.WidgetManager.Shared\u0022]\r\n    Contoso.WidgetManager.Shared/main.tsp: []\r\n\r\n\r\nExecuting rule: NpmPrefix\r\n2025-10-21T21:19:42.069Z simple-git [GitExecutor] [SPAWN] git [ \u0027rev-parse\u0027, \u0027--show-toplevel\u0027 ]\r\n2025-10-21T21:19:42.163Z simple-git [GitExecutor] [HANDLE] retrieving task output complete\r\nexecFile(\u0022C:\\nvm4w\\nodejs\\node.exe\u0022, [\u0022--\u0022,\u0022C:\\\\nvm4w\\\\nodejs\\\\node_modules\\\\npm\\\\bin\\\\npm-cli.js\u0022,\u0022prefix\u0022])\r\nExpected npm prefix: C:/Users/juanospina/source/repos/azure-rest-api-specs\r\nActual npm prefix: C:/Users/juanospina/source/repos/azure-rest-api-specs\r\n\r\nExecuting rule: EmitAutorest\r\nmainTspExists: true\r\nemit: [\u0022@azure-tools/typespec-autorest\u0022]\r\n\r\n\r\nExecuting rule: FlavorAzure\r\n\u0022@azure-tools/typespec-python\u0022:\r\n  flavor: azure\r\n\u0022@azure-tools/typespec-csharp\u0022:\r\n  flavor: azure\r\n\u0022@azure-tools/typespec-ts\u0022:\r\n  flavor: azure\r\n\u0022@azure-tools/typespec-java\u0022:\r\n  flavor: azure\r\n\r\n\r\nExecuting rule: LinterRuleset\r\nazure-resource-provider-folder: \u0022data-plane\u0022\r\nfiles: [\u0022main.tsp\u0022,\u0022client.tsp\u0022]\r\nlinter.extends: [\u0022@azure-tools/typespec-azure-rulesets/data-plane\u0022]\r\n\r\nExecuting rule: Compile\r\nexecFile(\u0022C:\\nvm4w\\nodejs\\node.exe\u0022, [\u0022--\u0022,\u0022C:\\\\nvm4w\\\\nodejs\\\\node_modules\\\\npm\\\\bin\\\\npm-cli.js\u0022,\u0022exec\u0022,\u0022--no\u0022,\u0022--\u0022,\u0022tsp\u0022,\u0022compile\u0022,\u0022--list-files\u0022,\u0022--warn-as-error\u0022,\u0022C:/Users/juanospina/source/repos/azure-rest-api-specs/specification/contosowidgetmanager/Contoso.WidgetManager\u0022])\r\nexecFile(\u0022C:\\nvm4w\\nodejs\\node.exe\u0022, [\u0022--\u0022,\u0022C:\\\\nvm4w\\\\nodejs\\\\node_modules\\\\npm\\\\bin\\\\npm-cli.js\u0022,\u0022exec\u0022,\u0022--no\u0022,\u0022--\u0022,\u0022tsp\u0022,\u0022compile\u0022,\u0022--no-emit\u0022,\u0022--warn-as-error\u0022,\u0022C:\\\\Users\\\\juanospina\\\\source\\\\repos\\\\azure-rest-api-specs\\\\specification\\\\contosowidgetmanager\\\\Contoso.WidgetManager\\\\client.tsp\u0022])\r\n2025-10-21T21:20:23.126Z simple-git [GitExecutor] [SPAWN] git [ \u0027status\u0027, \u0027--porcelain\u0027, \u0027-b\u0027, \u0027-u\u0027, \u0027--null\u0027, \u0027--porcelain\u0027, \u0027C:/Users/juanospina/source/repos/azure-rest-api-specs/specification/contosowidgetmanager\u0027 ]\r\n2025-10-21T21:20:23.476Z simple-git [GitExecutor] [HANDLE] retrieving task output complete\r\n2025-10-21T21:20:23.478Z simple-git [GitExecutor] [SPAWN] git [ \u0027status\u0027, \u0027--porcelain\u0027, \u0027-b\u0027, \u0027-u\u0027, \u0027--null\u0027 ]\r\n2025-10-21T21:20:24.233Z simple-git [GitExecutor] [HANDLE] retrieving task output complete\r\n2025-10-21T21:20:24.233Z simple-git [GitExecutor] [SPAWN] git [ \u0027diff\u0027 ]\r\n2025-10-21T21:20:24.690Z simple-git [GitExecutor] [HANDLE] retrieving task output complete\r\nTypeSpec compiler v1.2.1\r\n\r\n    \u001B[2mspecification/contosowidgetmanager/data-plane/Azure.Contoso.WidgetManager/preview/2022-11-01-preview/widgets.json\u001B[22m\r\n    \u001B[2mspecification/contosowidgetmanager/data-plane/Azure.Contoso.WidgetManager/preview/2022-11-01-preview/examples/Widgets_GetWidgetSample.json\u001B[22m\r\n    \u001B[2mspecification/contosowidgetmanager/data-plane/Azure.Contoso.WidgetManager/preview/2022-11-01-preview/examples/Widgets_GetWidgetOperationStatusSample.json\u001B[22m\r\n    \u001B[2mspecification/contosowidgetmanager/data-plane/Azure.Contoso.WidgetManager/preview/2022-11-01-preview/examples/Widgets_CreateOrUpdateWidgetSample.json\u001B[22m\r\n    \u001B[2mspecification/contosowidgetmanager/data-plane/Azure.Contoso.WidgetManager/preview/2022-11-01-preview/examples/Widgets_DeleteWidgetSample.json\u001B[22m\r\n    \u001B[2mspecification/contosowidgetmanager/data-plane/Azure.Contoso.WidgetManager/preview/2022-11-01-preview/examples/Widgets_ListWidgetsSample.json\u001B[22m\r\n    \u001B[2mspecification/contosowidgetmanager/data-plane/Azure.Contoso.WidgetManager/stable/2022-12-01/widgets.json\u001B[22m\r\n    \u001B[2mspecification/contosowidgetmanager/data-plane/Azure.Contoso.WidgetManager/stable/2022-12-01/examples/Widgets_GetWidgetSample.json\u001B[22m\r\n    \u001B[2mspecification/contosowidgetmanager/data-plane/Azure.Contoso.WidgetManager/stable/2022-12-01/examples/Widgets_GetWidgetOperationStatusSample.json\u001B[22m\r\n    \u001B[2mspecification/contosowidgetmanager/data-plane/Azure.Contoso.WidgetManager/stable/2022-12-01/examples/Widgets_CreateOrUpdateWidgetSample.json\u001B[22m\r\n    \u001B[2mspecification/contosowidgetmanager/data-plane/Azure.Contoso.WidgetManager/stable/2022-12-01/examples/Widgets_DeleteWidgetSample.json\u001B[22m\r\n    \u001B[2mspecification/contosowidgetmanager/data-plane/Azure.Contoso.WidgetManager/stable/2022-12-01/examples/Widgets_ListWidgetsSample.json\u001B[22m\r\n\r\nCompilation completed successfully.\r\n\r\n- Compiling...\r\n\u001B[32m\u0393\u00A3\u00F6\u001B[39m Compiling\r\n- Running @azure-tools/typespec-autorest...\r\n\u001B[32m\u0393\u00A3\u00F6\u001B[39m @azure-tools/typespec-autorest \u001B[32m398ms\u001B[39m \u001B[2mspecification/contosowidgetmanager/\u001B[22m\r\n\r\nGenerated Swaggers:\r\nspecification\\contosowidgetmanager\\data-plane\\Azure.Contoso.WidgetManager\\preview\\2022-11-01-preview\\widgets.json\r\nspecification\\contosowidgetmanager\\data-plane\\Azure.Contoso.WidgetManager\\stable\\2022-12-01\\widgets.json\r\n\r\nOutput folder:\r\nspecification\\contosowidgetmanager\\data-plane\\Azure.Contoso.WidgetManager\r\n\r\nSwaggers matching output folder and filename:\r\nspecification\\contosowidgetmanager\\data-plane\\Azure.Contoso.WidgetManager\\preview\\2022-11-01-preview\\widgets.json\r\nspecification\\contosowidgetmanager\\data-plane\\Azure.Contoso.WidgetManager\\stable\\2022-12-01\\widgets.json\r\n\r\nSwaggers excluded via suppressions.yaml:\r\n\r\n\r\nRemaining swaggers:\r\nspecification\\contosowidgetmanager\\data-plane\\Azure.Contoso.WidgetManager\\preview\\2022-11-01-preview\\widgets.json\r\nspecification\\contosowidgetmanager\\data-plane\\Azure.Contoso.WidgetManager\\stable\\2022-12-01\\widgets.json\r\nTypeSpec compiler v1.2.1\r\n\r\n\r\nCompilation completed successfully.\r\n\r\nRunning git diff on folder C:/Users/juanospina/source/repos/azure-rest-api-specs/specification/contosowidgetmanager\r\nRule Compile failed\r\n- Compiling...\r\n\u001B[32m\u0393\u00A3\u00F6\u001B[39m Compiling\r\n{\u0022not_added\u0022:[],\u0022conflicted\u0022:[],\u0022created\u0022:[],\u0022deleted\u0022:[],\u0022modified\u0022:[\u0022specification/contosowidgetmanager/Contoso.WidgetManager/main.tsp\u0022],\u0022renamed\u0022:[],\u0022files\u0022:[{\u0022path\u0022:\u0022specification/contosowidgetmanager/Contoso.WidgetManager/main.tsp\u0022,\u0022index\u0022:\u0022 \u0022,\u0022working_dir\u0022:\u0022M\u0022}],\u0022staged\u0022:[],\u0022ahead\u0022:0,\u0022behind\u0022:0,\u0022current\u0022:\u0022main\u0022,\u0022tracking\u0022:\u0022origin/main\u0022,\u0022detached\u0022:false}diff --git a/specification/contosowidgetmanager/Contoso.WidgetManager/main.tsp b/specification/contosowidgetmanager/Contoso.WidgetManager/main.tsp\r\nindex d87d7d155c..effd1f1530 100644\r\n--- a/specification/contosowidgetmanager/Contoso.WidgetManager/main.tsp\r\n\u002B\u002B\u002B b/specification/contosowidgetmanager/Contoso.WidgetManager/main.tsp\r\n@@ -16,9 \u002B16,11 @@ namespace Azure.Contoso.WidgetManager;\r\n \r\n @doc(\u0022Versions info.\u0022)\r\n enum Versions {\r\n\u002B  @useDependency(Azure.Core.Versions.v1_0_Preview_2)\r\n   @doc(\u0022The 2022-11-01-preview version.\u0022)\r\n   v2022_11_01_Preview: \u00222022-11-01-preview\u0022,\r\n \r\n\u002B  @useDependency(Azure.Core.Versions.v1_0_Preview_2)\r\n   @doc(\u0022The 2022-12-01 version.\u0022)\r\n   v2022_12_01: \u00222022-12-01\u0022,\r\n }\r\n\r\nFiles have been changed after \u0060tsp compile\u0060. Run \u0060tsp compile\u0060 and ensure all files are included in your change.\r\n\r\nTypeSpec validation failed!!!"]}
        """;

        public ChatMessage GetMockResponse(string callid)
        {
            return new ChatMessage(
                ChatRole.Tool,
                [
                    new FunctionResultContent(
                        callid,
                        toolResult
                    )
                ]
            );
        }

        public ChatMessage GetMockCall()
        {
            return new ChatMessage(
                ChatRole.Assistant,
                [
                    new FunctionCallContent(
                        CallId,
                        ToolName,
                        new Dictionary<string, object?>
                        {
                            { "typeSpecProjectRootPath", "C:\\Users\\juanospina\\source\\repos\\azure-rest-api-specs\\specification\\contosowidgetmanager\\Contoso.WidgetManager" }
                        }
                    )
                ]
            );
        }
    }
}
