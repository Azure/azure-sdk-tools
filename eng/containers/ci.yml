parameters:
- name: DockerDeployments
  type: object
  default:
  - name: mock_attestation
    dockerRepo: 'keyvault-mock-attestation'
    dockerFile: 'tools/keyvault-mock-attestation/Dockerfile'
    stableTags:
    - 'latest'
  - name: stress_watcher
    dockerRepo: 'stress/watcher'
    dockerFile: 'tools/stress-cluster/services/Stress.Watcher/Dockerfile'
    stableTags:
    - 'latest'
  - name: stress_deploy_test_resources
    dockerRepo: 'stress/deploy-test-resources'
    prepareScript: tools/stress-cluster/cluster/kubernetes/stress-test-addons/images/test-resource-deployer/prepare.ps1
    dockerFile: 'tools/stress-cluster/cluster/kubernetes/stress-test-addons/images/test-resource-deployer/Dockerfile'
    stableTags:
    - 'latest'
  - name: http_fault_injector
    dockerRepo: 'stress/httpfaultinjector'
    dockerFile: 'tools/http-fault-injector/Dockerfile'
    stableTags:
    - 'latest'
  - name: otel_collector
    dockerRepo: 'stress/otelcollector'
    dockerFile: 'tools/stress-cluster/services/otelcollector/Dockerfile'
    stableTags:
    - '0.94.0'

trigger:
  branches:
    include:
    - main
  paths:
    include:
    - eng/containers/
    - tools/keyvault-mock-attestation/Dockerfile
    - tools/stress-cluster/services/Stress.Watcher/
    - tools/stress-cluster/services/otelcollector/
    - tools/stress-cluster/cluster/kubernetes/stress-test-addons/images/test-resource-deployer/
    - tools/http-fault-injector/Dockerfile

pr:
  branches:
    include:
    - main
  paths:
    include:
    - eng/containers/
    - tools/keyvault-mock-attestation/Dockerfile
    - tools/stress-cluster/services/Stress.Watcher/
    - tools/stress-cluster/services/otelcollector/
    - tools/stress-cluster/cluster/kubernetes/stress-test-addons/images/test-resource-deployer/
    - tools/http-fault-injector/Dockerfile

variables:
  - name: containerRegistry
    value: 'azsdkengsys'
  - name: imageTag
    value: $(build.buildid)

extends:
  template: ../pipelines/publish-docker-image.yml
  parameters:
    DockerDeployments: ${{ parameters.DockerDeployments }}
    ImageTag: $(imageTag)

