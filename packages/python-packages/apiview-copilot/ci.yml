# NOTE: Please refer to https://aka.ms/azsdk/engsys/ci-yaml before editing this file.
trigger:
  branches:
    include:
      - main
  paths:
    include:
      - packages/python-packages/apiview-copilot

pr:
  branches:
    include:
      - main
  paths:
    include:
      - packages/python-packages/apiview-copilot

stages:
  - stage: apiview_copilot
    variables:
      - template: /eng/pipelines/templates/variables/image.yml

    jobs:
      - job: Package
        displayName: 'Package app'
        pool:
          name: $(LINUXPOOL)
          image: $(LINUXVMIMAGE)
          os: linux
        steps:
          - script: |
              zip -r app.zip .
            workingDirectory: packages/python-packages/apiview-copilot
            displayName: 'Package app into a zip file'
          - publish: packages/python-packages/apiview-copilot/app.zip
            artifact: drop

      - job: UnitTests
        displayName: 'Run Unit Tests'
        pool:
          vmImage: 'ubuntu-latest'
        steps:
          - script: |
              python -m pip install --upgrade pip
              pip install -r dev_requirements.txt
              pip install pytest
              pytest tests --junitxml=pytest-results.xml
            workingDirectory: packages/python-packages/apiview-copilot
            displayName: 'Run Unit Tests'

      - job: Lint
        displayName: 'Run Pylint'
        pool:
          vmImage: 'ubuntu-latest'
        steps:
          - script: |
              python -m pip install --upgrade pip
              pip install -r dev_requirements.txt
              pip install pylint
              pylint src scripts tests
            workingDirectory: packages/python-packages/apiview-copilot
            displayName: 'Run Pylint'

      - job: CopyrightHeaders
        displayName: 'Check copyright headers'
        pool:
          vmImage: 'ubuntu-latest'
        steps:
          - script: |
              python scripts/check_copyright_headers.py
            workingDirectory: packages/python-packages/apiview-copilot
            displayName: 'Check copyright headers'
