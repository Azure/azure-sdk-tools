using Azure.Sdk.Tools.Cli.Helpers;
using Azure.Sdk.Tools.Cli.Tests.TestHelpers;
using Azure.Sdk.Tools.Cli.Configuration;


namespace Azure.Sdk.Tools.Cli.Tests.Helpers;

internal class LabelHelperTests
{
    private ILabelHelper labelHelper;

    [SetUp]
    public void Setup()
    {
        labelHelper = new LabelHelper(new TestLogger<LabelHelper>());
    }

    [Test]
    [TestCase("TestService,Description,e99695\nAnotherService,Description2,e99695", "TestService", LabelHelper.ServiceLabelStatus.Exists)]
    [TestCase("TestService,Description,e99695\r\nAnotherService,Description2,e99695\nThirdService,Description3,e99695", "AnotherService", LabelHelper.ServiceLabelStatus.Exists)]
    [TestCase("TestService,Description,e99695\nAnotherService,Description2,e99695\r\n", "TestService", LabelHelper.ServiceLabelStatus.Exists)]
    [TestCase("TestService,Description,e99695\nAnotherService,Description2,e99695", "NonExistentService", LabelHelper.ServiceLabelStatus.DoesNotExist)]
    [TestCase("TestService,Description,123456\nAnotherService,Description2,e99695", "TestService", LabelHelper.ServiceLabelStatus.NotAServiceLabel)]
    [TestCase("Service - TestService,Description with commas and stuff,e99695\nAnotherService,Description2,e99695", "Service - TestService", LabelHelper.ServiceLabelStatus.Exists)]
    [TestCase("   \nAnotherService,Description2,e99695", "AnotherService", LabelHelper.ServiceLabelStatus.Exists)]
    [TestCase("TestService,Description\nAnotherService,Description2,e99695", "AnotherService", LabelHelper.ServiceLabelStatus.Exists)]
    public void TestCheckServiceLabel(string csvContent, string serviceLabel, LabelHelper.ServiceLabelStatus expected)
    {
        var actual = labelHelper.CheckServiceLabel(csvContent, serviceLabel);
        Assert.That(actual, Is.EqualTo(expected));
    }

    [Test]
    [TestCase("AAA,,e99695\nCCC,,e99695\nZZZ,,e99695", "BBB", "AAA,,e99695\nBBB,,e99695\nCCC,,e99695\nZZZ,,e99695")]
    [TestCase("BBB,,e99695\nCCC,,e99695\nZZZ,,e99695", "AAA", "AAA,,e99695\nBBB,,e99695\nCCC,,e99695\nZZZ,,e99695")]
    [TestCase("AAA,,e99695\nBBB,,e99695\nCCC,,e99695", "ZZZ", "AAA,,e99695\nBBB,,e99695\nCCC,,e99695\nZZZ,,e99695")]
    [TestCase("", "TestService", "TestService,,e99695")]
    [TestCase("AAA,,e99695", "BBB", "AAA,,e99695\nBBB,,e99695")]
    [TestCase("AAA,,e99695\r\nCCC,,e99695", "BBB", "AAA,,e99695\r\nBBB,,e99695\nCCC,,e99695")]
    [TestCase("AAA,,e99695\nCCC,,e99695\nZZZ,,e99695", "CCC", "AAA,,e99695\nCCC,,e99695\nCCC,,e99695\nZZZ,,e99695")]
    [TestCase("AAA,,e99695\n\nZZZ,,e99695", "BBB", "AAA,,e99695\nBBB,,e99695\nZZZ,,e99695")] // Test for empty line handling
    [TestCase("AAA,,e99695\n   \nZZZ,,e99695", "BBB", "AAA,,e99695\nBBB,,e99695\nZZZ,,e99695")] // Test for whitespace line handling
    public void TestCreateServiceLabel(string csvContent, string serviceLabel, string expected)
    {
        var actual = labelHelper.CreateServiceLabel(csvContent, serviceLabel);
        Assert.That(actual, Is.EqualTo(expected));
    }

    [Test]
    [TestCase("Test - Service", "test-service")]
    [TestCase("New Test Service", "new-test-service")]
    [TestCase("Test/Service", "test-service")]
    [TestCase("  Test Service  ", "test-service")]
    [TestCase("-Test Service-", "test-service")]
    [TestCase("  -Test Service-  ", "test-service")]
    public void TestNormalizeLabel(string input, string expected)
    {
        var actual = labelHelper.NormalizeLabel(input);
        Assert.That(actual, Is.EqualTo(expected));
    }
}
