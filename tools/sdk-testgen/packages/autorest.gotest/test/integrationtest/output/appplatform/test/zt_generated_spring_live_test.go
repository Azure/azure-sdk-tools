//go:build go1.16
// +build go1.16

// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License. See License.txt in the project root for license information.
// Code generated by Microsoft (R) AutoRest Code Generator.
// Changes may cause incorrect behavior and will be lost if the code is regenerated.

package test_test

import (
	"context"
	"testing"

	"time"

	"github.com/Azure/azure-sdk-for-go/sdk/azcore"
	"github.com/Azure/azure-sdk-for-go/sdk/azcore/arm"
	"github.com/Azure/azure-sdk-for-go/sdk/azcore/to"
	"github.com/Azure/azure-sdk-for-go/sdk/internal/recording"
	"github.com/Azure/azure-sdk-for-go/sdk/resourcemanager/internal/testutil"
	"github.com/Azure/azure-sdk-for-go/sdk/resourcemanager/resources/armresources"
	"github.com/stretchr/testify/suite"
)

type SpringTestSuite struct {
	suite.Suite

	ctx                        context.Context
	cred                       azcore.TokenCredential
	options                    *arm.ClientOptions
	appName                    string
	ascDomainName              string
	dnsCname                   string
	insightsInstrumentationKey string
	serviceName                string
	blobUrl                    string
	customDomainName           string
	dnsResourceGroup           string
	dnsSubscriptionId          string
	location                   string
	mysqlKey                   string
	resourceGroupName          string
	subscriptionId             string
	userAssignedIdentity       string
}

func (testsuite *SpringTestSuite) SetupSuite() {
	testsuite.ctx = context.Background()
	testsuite.cred, testsuite.options = testutil.GetCredAndClientOptions(testsuite.T())
	testsuite.appName = "app01"
	testsuite.ascDomainName = ".azuremicroservices.io"
	testsuite.dnsCname = "asc"
	testsuite.serviceName = "test-scenario-instance"
	testsuite.blobUrl = testutil.GetEnv("BLOB_URL", "")
	testsuite.customDomainName = testutil.GetEnv("CUSTOM_DOMAIN_NAME", "")
	testsuite.dnsResourceGroup = testutil.GetEnv("DNS_RESOURCE_GROUP", "")
	testsuite.dnsSubscriptionId = testutil.GetEnv("DNS_SUBSCRIPTION_ID", "")
	testsuite.location = testutil.GetEnv("LOCATION", "eastus")
	testsuite.mysqlKey = testutil.GetEnv("MYSQL_KEY", "")
	testsuite.resourceGroupName = testutil.GetEnv("RESOURCE_GROUP_NAME", "")
	testsuite.subscriptionId = testutil.GetEnv("AZURE_SUBSCRIPTION_ID", "")
	testsuite.userAssignedIdentity = testutil.GetEnv("USER_ASSIGNED_IDENTITY", "")

	testutil.StartRecording(testsuite.T(), "sdk/resourcemanager//test/testdata")
	resourceGroup, _, err := testutil.CreateResourceGroup(testsuite.ctx, testsuite.subscriptionId, testsuite.cred, testsuite.options, testsuite.location)
	testsuite.Require().NoError(err)
	testsuite.resourceGroupName = *resourceGroup.Name
	testsuite.Prepare()
}

func (testsuite *SpringTestSuite) TearDownSuite() {
	testsuite.Cleanup()
	_, err := testutil.DeleteResourceGroup(testsuite.ctx, testsuite.subscriptionId, testsuite.cred, testsuite.options, testsuite.resourceGroupName)
	testsuite.Require().NoError(err)
	testutil.StopRecording(testsuite.T())
}

func TestSpringTestSuite(t *testing.T) {
	suite.Run(t, new(SpringTestSuite))
}

func (testsuite *SpringTestSuite) Prepare() {
	var err error
	// From step Generate_Unique_ServiceName
	template := map[string]interface{}{
		"$schema":        "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
		"contentVersion": "1.0.0.0",
		"outputs": map[string]interface{}{
			"serviceName": map[string]interface{}{
				"type":  "string",
				"value": "[substring(variables('serviceNameLong'), 0, 12)]",
			},
		},
		"parameters": map[string]interface{}{
			"serviceNamePrefix": map[string]interface{}{
				"type":         "string",
				"defaultValue": "asc-",
			},
		},
		"resources": []interface{}{},
		"variables": map[string]interface{}{
			"serviceNameLong": "[concat(parameters('serviceNamePrefix'), uniqueString(resourceGroup().id))]",
		},
	}
	params := map[string]interface{}{}
	deployment := armresources.Deployment{
		Properties: &armresources.DeploymentProperties{
			Template:   template,
			Parameters: params,
			Mode:       armresources.DeploymentModeIncremental.ToPtr(),
		},
	}
	deploymentExtend, err := testutil.CreateDeployment(testsuite.ctx, testsuite.subscriptionId, testsuite.cred, testsuite.options, testsuite.resourceGroupName, "Generate_Unique_ServiceName", &deployment)
	testsuite.Require().NoError(err)
	testsuite.serviceName = deploymentExtend.Properties.Outputs["serviceName"].(map[string]interface{})["value"].(string)

	// From step Create_Application_Insight_Instance
	template = map[string]interface{}{
		"$schema":        "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
		"contentVersion": "1.0.0.0",
		"outputs": map[string]interface{}{
			"insightsInstrumentationKey": map[string]interface{}{
				"type":  "string",
				"value": "[reference(resourceId('Microsoft.Insights/components', parameters('name')), '2014-04-01').InstrumentationKey]",
			},
		},
		"parameters": map[string]interface{}{
			"name": map[string]interface{}{
				"type":         "string",
				"defaultValue": "asc-api-ai-instance",
				"metadata": map[string]interface{}{
					"description": "Name of Application Insights resource.",
				},
			},
		},
		"resources": []interface{}{
			map[string]interface{}{
				"name":       "[parameters('name')]",
				"type":       "microsoft.insights/components",
				"apiVersion": "2014-04-01",
				"location":   "eastus",
				"properties": map[string]interface{}{
					"ApplicationId":    "[parameters('name')]",
					"Application_Type": "web",
					"Flow_Type":        "Redfield",
					"Request_Source":   "CustomDeployment",
				},
				"tags": map[string]interface{}{},
			},
		},
	}
	params = map[string]interface{}{}
	deployment = armresources.Deployment{
		Properties: &armresources.DeploymentProperties{
			Template:   template,
			Parameters: params,
			Mode:       armresources.DeploymentModeIncremental.ToPtr(),
		},
	}
	deploymentExtend, err = testutil.CreateDeployment(testsuite.ctx, testsuite.subscriptionId, testsuite.cred, testsuite.options, testsuite.resourceGroupName, "Create_Application_Insight_Instance", &deployment)
	testsuite.Require().NoError(err)
	testsuite.insightsInstrumentationKey = deploymentExtend.Properties.Outputs["insightsInstrumentationKey"].(map[string]interface{})["value"].(string)

	// From step Add_Dns_Cname_Record
	template = map[string]interface{}{
		"$schema":        "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
		"contentVersion": "1.0.0.0",
		"parameters": map[string]interface{}{
			"userAssignedIdentity": map[string]interface{}{
				"type":         "string",
				"defaultValue": "$(userAssignedIdentity)",
			},
			"utcValue": map[string]interface{}{
				"type":         "string",
				"defaultValue": "[utcNow()]",
			},
		},
		"resources": []interface{}{
			map[string]interface{}{
				"name":       "Add_Dns_Cname_Record",
				"type":       "Microsoft.Resources/deploymentScripts",
				"apiVersion": "2020-10-01",
				"identity": map[string]interface{}{
					"type": "UserAssigned",
					"userAssignedIdentities": map[string]interface{}{
						"[parameters('userAssignedIdentity')]": map[string]interface{}{},
					},
				},
				"kind":     "AzurePowerShell",
				"location": "[resourceGroup().location]",
				"properties": map[string]interface{}{
					"azPowerShellVersion": "6.2",
					"cleanupPreference":   "OnSuccess",
					"environmentVariables": []interface{}{
						map[string]interface{}{
							"name":  "resourceGroupName",
							"value": testsuite.dnsResourceGroup,
						},
						map[string]interface{}{
							"name":  "dnsZoneName",
							"value": testsuite.customDomainName,
						},
						map[string]interface{}{
							"name":  "dnsCname",
							"value": "asc",
						},
						map[string]interface{}{
							"name":  "dnsCnameAlias",
							"value": testsuite.serviceName + ".azuremicroservices.io",
						},
					},
					"forceUpdateTag":    "[parameters('utcValue')]",
					"retentionInterval": "P1D",
					"scriptContent":     "# Copyright (c) 2021 Microsoft Corporation\n# \n# This software is released under the MIT License.\n# https://opensource.org/licenses/MIT\n$resourceGroupName = ${Env:resourceGroupName}\n$dnsCname = ${Env:dnsCname}\n$dnsZoneName = ${Env:dnsZoneName}\n$dnsCnameAlias = ${Env:dnsCnameAlias}\nConnect-AzAccount -Identity\nNew-AzDnsRecordSet -Name $dnsCname -RecordType CNAME -ZoneName $dnsZoneName -ResourceGroupName $resourceGroupName -Ttl 3600 -DnsRecords (New-AzDnsRecordConfig -Cname $dnsCnameAlias) -Overwrite\n$RecordSet = Get-AzDnsRecordSet -Name $dnsCname -RecordType CNAME -ResourceGroupName $resourceGroupName -ZoneName $dnsZoneName\n$RecordSet",
					"timeout":           "PT1H",
				},
			},
		},
	}
	params = map[string]interface{}{
		"userAssignedIdentity": map[string]interface{}{"value": testsuite.userAssignedIdentity},
	}
	deployment = armresources.Deployment{
		Properties: &armresources.DeploymentProperties{
			Template:   template,
			Parameters: params,
			Mode:       armresources.DeploymentModeIncremental.ToPtr(),
		},
	}
	_, err = testutil.CreateDeployment(testsuite.ctx, testsuite.subscriptionId, testsuite.cred, testsuite.options, testsuite.resourceGroupName, "Add_Dns_Cname_Record", &deployment)
	testsuite.Require().NoError(err)
}

func (testsuite *SpringTestSuite) TestSpring() {
	var relativePath string
	var uploadUrl string
	var err error
	// From step Services_CheckNameAvailability
	servicesClient := test.NewServicesClient(testsuite.subscriptionId, testsuite.cred, testsuite.options)
	_, err = servicesClient.CheckNameAvailability(testsuite.ctx,
		testsuite.location,
		test.NameAvailabilityParameters{
			Name: to.StringPtr(testsuite.serviceName),
			Type: to.StringPtr("Microsoft.AppPlatform/Spring"),
		},
		nil)
	testsuite.Require().NoError(err)

	// From step Services_CreateOrUpdate
	servicesClientCreateOrUpdatePollerResponse, err := servicesClient.BeginCreateOrUpdate(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		test.ServiceResource{
			Location: to.StringPtr(testsuite.location),
			Tags: map[string]*string{
				"key1": to.StringPtr("value1"),
			},
			Properties: &test.ClusterResourceProperties{},
			SKU: &test.SKU{
				Name: to.StringPtr("S0"),
				Tier: to.StringPtr("Standard"),
			},
		},
		nil)
	testsuite.Require().NoError(err)
	if recording.GetRecordMode() == recording.PlaybackMode {
		for {
			_, err = servicesClientCreateOrUpdatePollerResponse.Poller.Poll(testsuite.ctx)
			testsuite.Require().NoError(err)
			if servicesClientCreateOrUpdatePollerResponse.Poller.Done() {
				_, err = servicesClientCreateOrUpdatePollerResponse.Poller.FinalResponse(testsuite.ctx)
				testsuite.Require().NoError(err)
				break
			}
		}
	} else {
		_, err = servicesClientCreateOrUpdatePollerResponse.PollUntilDone(testsuite.ctx, 10*time.Second)
		testsuite.Require().NoError(err)
	}

	// From step Services_Get
	_, err = servicesClient.Get(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		nil)
	testsuite.Require().NoError(err)

	// From step Services_Update
	servicesClientUpdatePollerResponse, err := servicesClient.BeginUpdate(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		test.ServiceResource{
			Tags: map[string]*string{
				"created-by": to.StringPtr("api-test"),
				"hello":      to.StringPtr("world"),
			},
			SKU: &test.SKU{
				Name: to.StringPtr("S0"),
				Tier: to.StringPtr("Standard"),
			},
		},
		nil)
	testsuite.Require().NoError(err)
	if recording.GetRecordMode() == recording.PlaybackMode {
		for {
			_, err = servicesClientUpdatePollerResponse.Poller.Poll(testsuite.ctx)
			testsuite.Require().NoError(err)
			if servicesClientUpdatePollerResponse.Poller.Done() {
				_, err = servicesClientUpdatePollerResponse.Poller.FinalResponse(testsuite.ctx)
				testsuite.Require().NoError(err)
				break
			}
		}
	} else {
		_, err = servicesClientUpdatePollerResponse.PollUntilDone(testsuite.ctx, 10*time.Second)
		testsuite.Require().NoError(err)
	}

	// From step Services_DisableTestEndpoint
	_, err = servicesClient.DisableTestEndpoint(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		nil)
	testsuite.Require().NoError(err)

	// From step Services_EnableTestEndpoint
	_, err = servicesClient.EnableTestEndpoint(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		nil)
	testsuite.Require().NoError(err)

	// From step Services_RegenerateTestKey
	_, err = servicesClient.RegenerateTestKey(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		test.RegenerateTestKeyRequestPayload{
			KeyType: test.TestKeyTypePrimary.ToPtr(),
		},
		nil)
	testsuite.Require().NoError(err)

	// From step Services_ListTestKeys
	_, err = servicesClient.ListTestKeys(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		nil)
	testsuite.Require().NoError(err)

	// From step Certificates_CreateOrUpdate
	certificatesClient := test.NewCertificatesClient(testsuite.subscriptionId, testsuite.cred, testsuite.options)
	certificateName := "asc-certificate"
	certificatesClientCreateOrUpdatePollerResponse, err := certificatesClient.BeginCreateOrUpdate(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		certificateName,
		test.CertificateResource{
			Properties: &test.CertificateProperties{
				KeyVaultCertName: to.StringPtr("pfx-cert"),
				VaultURI:         to.StringPtr("https://integration-test-prod.vault.azure.net/"),
			},
		},
		nil)
	testsuite.Require().NoError(err)
	if recording.GetRecordMode() == recording.PlaybackMode {
		for {
			_, err = certificatesClientCreateOrUpdatePollerResponse.Poller.Poll(testsuite.ctx)
			testsuite.Require().NoError(err)
			if certificatesClientCreateOrUpdatePollerResponse.Poller.Done() {
				_, err = certificatesClientCreateOrUpdatePollerResponse.Poller.FinalResponse(testsuite.ctx)
				testsuite.Require().NoError(err)
				break
			}
		}
	} else {
		_, err = certificatesClientCreateOrUpdatePollerResponse.PollUntilDone(testsuite.ctx, 10*time.Second)
		testsuite.Require().NoError(err)
	}

	// From step Certificates_Get
	certificateName = "asc-certificate"
	_, err = certificatesClient.Get(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		certificateName,
		nil)
	testsuite.Require().NoError(err)

	// From step Certificates_List
	certificatesClientListPager := certificatesClient.List(testsuite.resourceGroupName,
		testsuite.serviceName,
		nil)
	for certificatesClientListPager.NextPage(testsuite.ctx) {
		err = certificatesClientListPager.Err()
		testsuite.Require().NoError(err)
		for _, v := range certificatesClientListPager.PageResponse().Value {
			_ = v
		}
	}

	// From step ConfigServers_Validate
	configServersClient := test.NewConfigServersClient(testsuite.subscriptionId, testsuite.cred, testsuite.options)
	configServersClientValidatePollerResponse, err := configServersClient.BeginValidate(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		test.ConfigServerSettings{
			GitProperty: &test.ConfigServerGitProperty{
				Label: to.StringPtr("master"),
				SearchPaths: []*string{
					to.StringPtr("/")},
				URI: to.StringPtr("https://github.com/VSChina/asc-config-server-test-public.git"),
			},
		},
		nil)
	testsuite.Require().NoError(err)
	if recording.GetRecordMode() == recording.PlaybackMode {
		for {
			_, err = configServersClientValidatePollerResponse.Poller.Poll(testsuite.ctx)
			testsuite.Require().NoError(err)
			if configServersClientValidatePollerResponse.Poller.Done() {
				_, err = configServersClientValidatePollerResponse.Poller.FinalResponse(testsuite.ctx)
				testsuite.Require().NoError(err)
				break
			}
		}
	} else {
		_, err = configServersClientValidatePollerResponse.PollUntilDone(testsuite.ctx, 10*time.Second)
		testsuite.Require().NoError(err)
	}

	// From step ConfigServers_UpdatePut
	configServersClientUpdatePutPollerResponse, err := configServersClient.BeginUpdatePut(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		test.ConfigServerResource{
			Properties: &test.ConfigServerProperties{
				ConfigServer: &test.ConfigServerSettings{
					GitProperty: &test.ConfigServerGitProperty{
						Label: to.StringPtr("master"),
						SearchPaths: []*string{
							to.StringPtr("/")},
						URI: to.StringPtr("https://github.com/VSChina/asc-config-server-test-public.git"),
					},
				},
			},
		},
		nil)
	testsuite.Require().NoError(err)
	if recording.GetRecordMode() == recording.PlaybackMode {
		for {
			_, err = configServersClientUpdatePutPollerResponse.Poller.Poll(testsuite.ctx)
			testsuite.Require().NoError(err)
			if configServersClientUpdatePutPollerResponse.Poller.Done() {
				_, err = configServersClientUpdatePutPollerResponse.Poller.FinalResponse(testsuite.ctx)
				testsuite.Require().NoError(err)
				break
			}
		}
	} else {
		_, err = configServersClientUpdatePutPollerResponse.PollUntilDone(testsuite.ctx, 10*time.Second)
		testsuite.Require().NoError(err)
	}

	// From step ConfigServers_UpdatePatch
	configServersClientUpdatePatchPollerResponse, err := configServersClient.BeginUpdatePatch(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		test.ConfigServerResource{
			Properties: &test.ConfigServerProperties{
				ConfigServer: &test.ConfigServerSettings{
					GitProperty: &test.ConfigServerGitProperty{
						URI: to.StringPtr("https://github.com/azure-samples/spring-petclinic-microservices-config"),
					},
				},
			},
		},
		nil)
	testsuite.Require().NoError(err)
	if recording.GetRecordMode() == recording.PlaybackMode {
		for {
			_, err = configServersClientUpdatePatchPollerResponse.Poller.Poll(testsuite.ctx)
			testsuite.Require().NoError(err)
			if configServersClientUpdatePatchPollerResponse.Poller.Done() {
				_, err = configServersClientUpdatePatchPollerResponse.Poller.FinalResponse(testsuite.ctx)
				testsuite.Require().NoError(err)
				break
			}
		}
	} else {
		_, err = configServersClientUpdatePatchPollerResponse.PollUntilDone(testsuite.ctx, 10*time.Second)
		testsuite.Require().NoError(err)
	}

	// From step ConfigServers_Get
	_, err = configServersClient.Get(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		nil)
	testsuite.Require().NoError(err)

	// From step MonitoringSettings_UpdatePut
	monitoringSettingsClient := test.NewMonitoringSettingsClient(testsuite.subscriptionId, testsuite.cred, testsuite.options)
	monitoringSettingsClientUpdatePutPollerResponse, err := monitoringSettingsClient.BeginUpdatePut(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		test.MonitoringSettingResource{
			Properties: &test.MonitoringSettingProperties{
				AppInsightsInstrumentationKey: to.StringPtr(testsuite.insightsInstrumentationKey),
				AppInsightsSamplingRate:       to.Float64Ptr(50),
				TraceEnabled:                  to.BoolPtr(true),
			},
		},
		nil)
	testsuite.Require().NoError(err)
	if recording.GetRecordMode() == recording.PlaybackMode {
		for {
			_, err = monitoringSettingsClientUpdatePutPollerResponse.Poller.Poll(testsuite.ctx)
			testsuite.Require().NoError(err)
			if monitoringSettingsClientUpdatePutPollerResponse.Poller.Done() {
				_, err = monitoringSettingsClientUpdatePutPollerResponse.Poller.FinalResponse(testsuite.ctx)
				testsuite.Require().NoError(err)
				break
			}
		}
	} else {
		_, err = monitoringSettingsClientUpdatePutPollerResponse.PollUntilDone(testsuite.ctx, 10*time.Second)
		testsuite.Require().NoError(err)
	}

	// From step MonitoringSettings_Get
	_, err = monitoringSettingsClient.Get(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		nil)
	testsuite.Require().NoError(err)

	// From step MonitoringSettings_UpdatePatch
	monitoringSettingsClientUpdatePatchPollerResponse, err := monitoringSettingsClient.BeginUpdatePatch(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		test.MonitoringSettingResource{
			Properties: &test.MonitoringSettingProperties{
				AppInsightsSamplingRate: to.Float64Ptr(100),
			},
		},
		nil)
	testsuite.Require().NoError(err)
	if recording.GetRecordMode() == recording.PlaybackMode {
		for {
			_, err = monitoringSettingsClientUpdatePatchPollerResponse.Poller.Poll(testsuite.ctx)
			testsuite.Require().NoError(err)
			if monitoringSettingsClientUpdatePatchPollerResponse.Poller.Done() {
				_, err = monitoringSettingsClientUpdatePatchPollerResponse.Poller.FinalResponse(testsuite.ctx)
				testsuite.Require().NoError(err)
				break
			}
		}
	} else {
		_, err = monitoringSettingsClientUpdatePatchPollerResponse.PollUntilDone(testsuite.ctx, 10*time.Second)
		testsuite.Require().NoError(err)
	}

	// From step Apps_Create
	appsClient := test.NewAppsClient(testsuite.subscriptionId, testsuite.cred, testsuite.options)
	appsClientCreateOrUpdatePollerResponse, err := appsClient.BeginCreateOrUpdate(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		testsuite.appName,
		test.AppResource{
			Identity: &test.ManagedIdentityProperties{
				Type:        test.ManagedIdentityTypeSystemAssigned.ToPtr(),
				PrincipalID: to.StringPtr("principalid"),
				TenantID:    to.StringPtr("tenantid"),
			},
			Location: to.StringPtr(testsuite.location),
			Properties: &test.AppResourceProperties{
				ActiveDeploymentName: to.StringPtr("mydeployment1"),
				EnableEndToEndTLS:    to.BoolPtr(false),
				Fqdn:                 to.StringPtr(testsuite.appName + ".mydomain.com"),
				HTTPSOnly:            to.BoolPtr(false),
				Public:               to.BoolPtr(false),
			},
		},
		nil)
	testsuite.Require().NoError(err)
	if recording.GetRecordMode() == recording.PlaybackMode {
		for {
			_, err = appsClientCreateOrUpdatePollerResponse.Poller.Poll(testsuite.ctx)
			testsuite.Require().NoError(err)
			if appsClientCreateOrUpdatePollerResponse.Poller.Done() {
				_, err = appsClientCreateOrUpdatePollerResponse.Poller.FinalResponse(testsuite.ctx)
				testsuite.Require().NoError(err)
				break
			}
		}
	} else {
		_, err = appsClientCreateOrUpdatePollerResponse.PollUntilDone(testsuite.ctx, 10*time.Second)
		testsuite.Require().NoError(err)
	}

	// From step Apps_Get
	_, err = appsClient.Get(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		testsuite.appName,
		&test.AppsClientGetOptions{SyncStatus: nil})
	testsuite.Require().NoError(err)

	// From step Deployments_CreateOrUpdate_Default
	deploymentsClient := test.NewDeploymentsClient(testsuite.subscriptionId, testsuite.cred, testsuite.options)
	deploymentName := "default"
	deploymentsClientCreateOrUpdatePollerResponse, err := deploymentsClient.BeginCreateOrUpdate(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		testsuite.appName,
		deploymentName,
		test.DeploymentResource{
			Properties: &test.DeploymentResourceProperties{
				DeploymentSettings: &test.DeploymentSettings{
					CPU: to.Int32Ptr(1),
					EnvironmentVariables: map[string]*string{
						"env": to.StringPtr("test"),
					},
					JvmOptions:     to.StringPtr("-Xms1G -Xmx3G"),
					MemoryInGB:     to.Int32Ptr(3),
					RuntimeVersion: test.RuntimeVersionJava8.ToPtr(),
				},
				Source: &test.UserSourceInfo{
					Type:             test.UserSourceTypeJar.ToPtr(),
					ArtifactSelector: to.StringPtr("sub-module-1"),
					RelativePath:     to.StringPtr("<default>"),
					Version:          to.StringPtr("1.0"),
				},
			},
			SKU: &test.SKU{
				Name:     to.StringPtr("S0"),
				Capacity: to.Int32Ptr(1),
				Tier:     to.StringPtr("Standard"),
			},
		},
		nil)
	testsuite.Require().NoError(err)
	if recording.GetRecordMode() == recording.PlaybackMode {
		for {
			_, err = deploymentsClientCreateOrUpdatePollerResponse.Poller.Poll(testsuite.ctx)
			testsuite.Require().NoError(err)
			if deploymentsClientCreateOrUpdatePollerResponse.Poller.Done() {
				_, err = deploymentsClientCreateOrUpdatePollerResponse.Poller.FinalResponse(testsuite.ctx)
				testsuite.Require().NoError(err)
				break
			}
		}
	} else {
		_, err = deploymentsClientCreateOrUpdatePollerResponse.PollUntilDone(testsuite.ctx, 10*time.Second)
		testsuite.Require().NoError(err)
	}

	// From step Deployments_Get
	deploymentName = "default"
	_, err = deploymentsClient.Get(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		testsuite.appName,
		deploymentName,
		nil)
	testsuite.Require().NoError(err)

	// From step Apps_Update_ActiveDeployment
	appsClientUpdatePollerResponse, err := appsClient.BeginUpdate(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		testsuite.appName,
		test.AppResource{
			Identity: &test.ManagedIdentityProperties{
				Type:        test.ManagedIdentityTypeSystemAssigned.ToPtr(),
				PrincipalID: to.StringPtr("principalid"),
				TenantID:    to.StringPtr("tenantid"),
			},
			Properties: &test.AppResourceProperties{
				ActiveDeploymentName: to.StringPtr("default"),
			},
		},
		nil)
	testsuite.Require().NoError(err)
	if recording.GetRecordMode() == recording.PlaybackMode {
		for {
			_, err = appsClientUpdatePollerResponse.Poller.Poll(testsuite.ctx)
			testsuite.Require().NoError(err)
			if appsClientUpdatePollerResponse.Poller.Done() {
				_, err = appsClientUpdatePollerResponse.Poller.FinalResponse(testsuite.ctx)
				testsuite.Require().NoError(err)
				break
			}
		}
	} else {
		_, err = appsClientUpdatePollerResponse.PollUntilDone(testsuite.ctx, 10*time.Second)
		testsuite.Require().NoError(err)
	}

	// From step Apps_Update_Disk
	appsClientUpdatePollerResponse, err = appsClient.BeginUpdate(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		testsuite.appName,
		test.AppResource{
			Identity: &test.ManagedIdentityProperties{
				Type:        test.ManagedIdentityTypeSystemAssigned.ToPtr(),
				PrincipalID: to.StringPtr("principalid"),
				TenantID:    to.StringPtr("tenantid"),
			},
			Properties: &test.AppResourceProperties{
				PersistentDisk: &test.PersistentDisk{
					MountPath: to.StringPtr("/data"),
					SizeInGB:  to.Int32Ptr(10),
				},
				TemporaryDisk: &test.TemporaryDisk{
					MountPath: to.StringPtr("/tmpdisk"),
					SizeInGB:  to.Int32Ptr(3),
				},
			},
		},
		nil)
	testsuite.Require().NoError(err)
	if recording.GetRecordMode() == recording.PlaybackMode {
		for {
			_, err = appsClientUpdatePollerResponse.Poller.Poll(testsuite.ctx)
			testsuite.Require().NoError(err)
			if appsClientUpdatePollerResponse.Poller.Done() {
				_, err = appsClientUpdatePollerResponse.Poller.FinalResponse(testsuite.ctx)
				testsuite.Require().NoError(err)
				break
			}
		}
	} else {
		_, err = appsClientUpdatePollerResponse.PollUntilDone(testsuite.ctx, 10*time.Second)
		testsuite.Require().NoError(err)
	}

	// From step Apps_List
	appsClientListPager := appsClient.List(testsuite.resourceGroupName,
		testsuite.serviceName,
		nil)
	for appsClientListPager.NextPage(testsuite.ctx) {
		err = appsClientListPager.Err()
		testsuite.Require().NoError(err)
		for _, v := range appsClientListPager.PageResponse().Value {
			_ = v
		}
	}

	// From step Bindings_Create
	bindingsClient := test.NewBindingsClient(testsuite.subscriptionId, testsuite.cred, testsuite.options)
	bindingName := "mysql-binding"
	bindingsClientCreateOrUpdatePollerResponse, err := bindingsClient.BeginCreateOrUpdate(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		testsuite.appName,
		bindingName,
		test.BindingResource{
			Properties: &test.BindingResourceProperties{
				BindingParameters: map[string]interface{}{
					"databaseName": "mysqldb",
					"username":     "test",
				},
				Key:        to.StringPtr(testsuite.mysqlKey),
				ResourceID: to.StringPtr("/subscriptions/b46590cb-a111-4b84-935f-c305aaf1f424/resourceGroups/mary-west/providers/Microsoft.DBforMySQL/servers/fake-sql"),
			},
		},
		nil)
	testsuite.Require().NoError(err)
	if recording.GetRecordMode() == recording.PlaybackMode {
		for {
			_, err = bindingsClientCreateOrUpdatePollerResponse.Poller.Poll(testsuite.ctx)
			testsuite.Require().NoError(err)
			if bindingsClientCreateOrUpdatePollerResponse.Poller.Done() {
				_, err = bindingsClientCreateOrUpdatePollerResponse.Poller.FinalResponse(testsuite.ctx)
				testsuite.Require().NoError(err)
				break
			}
		}
	} else {
		_, err = bindingsClientCreateOrUpdatePollerResponse.PollUntilDone(testsuite.ctx, 10*time.Second)
		testsuite.Require().NoError(err)
	}

	// From step Bindings_Update
	bindingName = "mysql-binding"
	bindingsClientUpdatePollerResponse, err := bindingsClient.BeginUpdate(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		testsuite.appName,
		bindingName,
		test.BindingResource{
			Properties: &test.BindingResourceProperties{
				BindingParameters: map[string]interface{}{
					"databaseName": "mysqldb2",
					"username":     "test2",
				},
				Key:        to.StringPtr(testsuite.mysqlKey),
				ResourceID: to.StringPtr("/subscriptions/" + testsuite.subscriptionId + "/resourceGroups/" + testsuite.resourceGroupName + "/providers/Microsoft.DocumentDB/databaseAccounts/my-cosmosdb-1"),
			},
		},
		nil)
	testsuite.Require().NoError(err)
	if recording.GetRecordMode() == recording.PlaybackMode {
		for {
			_, err = bindingsClientUpdatePollerResponse.Poller.Poll(testsuite.ctx)
			testsuite.Require().NoError(err)
			if bindingsClientUpdatePollerResponse.Poller.Done() {
				_, err = bindingsClientUpdatePollerResponse.Poller.FinalResponse(testsuite.ctx)
				testsuite.Require().NoError(err)
				break
			}
		}
	} else {
		_, err = bindingsClientUpdatePollerResponse.PollUntilDone(testsuite.ctx, 10*time.Second)
		testsuite.Require().NoError(err)
	}

	// From step Bindings_Get
	bindingName = "mysql-binding"
	_, err = bindingsClient.Get(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		testsuite.appName,
		bindingName,
		nil)
	testsuite.Require().NoError(err)

	// From step Bindings_List
	bindingsClientListPager := bindingsClient.List(testsuite.resourceGroupName,
		testsuite.serviceName,
		testsuite.appName,
		nil)
	for bindingsClientListPager.NextPage(testsuite.ctx) {
		err = bindingsClientListPager.Err()
		testsuite.Require().NoError(err)
		for _, v := range bindingsClientListPager.PageResponse().Value {
			_ = v
		}
	}

	// From step Bindings_Delete
	bindingName = "mysql-binding"
	bindingsClientDeletePollerResponse, err := bindingsClient.BeginDelete(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		testsuite.appName,
		bindingName,
		nil)
	testsuite.Require().NoError(err)
	if recording.GetRecordMode() == recording.PlaybackMode {
		for {
			_, err = bindingsClientDeletePollerResponse.Poller.Poll(testsuite.ctx)
			testsuite.Require().NoError(err)
			if bindingsClientDeletePollerResponse.Poller.Done() {
				_, err = bindingsClientDeletePollerResponse.Poller.FinalResponse(testsuite.ctx)
				testsuite.Require().NoError(err)
				break
			}
		}
	} else {
		_, err = bindingsClientDeletePollerResponse.PollUntilDone(testsuite.ctx, 10*time.Second)
		testsuite.Require().NoError(err)
	}

	// From step Apps_ValidateDomain
	_, err = appsClient.ValidateDomain(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		testsuite.appName,
		test.CustomDomainValidatePayload{
			Name: to.StringPtr(testsuite.customDomainName),
		},
		nil)
	testsuite.Require().NoError(err)

	// From step CustomDomains_CreateOrUpdate
	customDomainsClient := test.NewCustomDomainsClient(testsuite.subscriptionId, testsuite.cred, testsuite.options)
	domainName := testsuite.dnsCname + "." + testsuite.customDomainName
	customDomainsClientCreateOrUpdatePollerResponse, err := customDomainsClient.BeginCreateOrUpdate(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		testsuite.appName,
		domainName,
		test.CustomDomainResource{
			Properties: &test.CustomDomainProperties{
				CertName: to.StringPtr("asc-certificate"),
			},
		},
		nil)
	testsuite.Require().NoError(err)
	if recording.GetRecordMode() == recording.PlaybackMode {
		for {
			_, err = customDomainsClientCreateOrUpdatePollerResponse.Poller.Poll(testsuite.ctx)
			testsuite.Require().NoError(err)
			if customDomainsClientCreateOrUpdatePollerResponse.Poller.Done() {
				_, err = customDomainsClientCreateOrUpdatePollerResponse.Poller.FinalResponse(testsuite.ctx)
				testsuite.Require().NoError(err)
				break
			}
		}
	} else {
		_, err = customDomainsClientCreateOrUpdatePollerResponse.PollUntilDone(testsuite.ctx, 10*time.Second)
		testsuite.Require().NoError(err)
	}

	// From step CustomDomains_Update
	domainName = testsuite.dnsCname + "." + testsuite.customDomainName
	customDomainsClientUpdatePollerResponse, err := customDomainsClient.BeginUpdate(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		testsuite.appName,
		domainName,
		test.CustomDomainResource{
			Properties: &test.CustomDomainProperties{
				CertName: to.StringPtr("asc-certificate"),
			},
		},
		nil)
	testsuite.Require().NoError(err)
	if recording.GetRecordMode() == recording.PlaybackMode {
		for {
			_, err = customDomainsClientUpdatePollerResponse.Poller.Poll(testsuite.ctx)
			testsuite.Require().NoError(err)
			if customDomainsClientUpdatePollerResponse.Poller.Done() {
				_, err = customDomainsClientUpdatePollerResponse.Poller.FinalResponse(testsuite.ctx)
				testsuite.Require().NoError(err)
				break
			}
		}
	} else {
		_, err = customDomainsClientUpdatePollerResponse.PollUntilDone(testsuite.ctx, 10*time.Second)
		testsuite.Require().NoError(err)
	}

	// From step CustomDomains_Get
	domainName = testsuite.dnsCname + "." + testsuite.customDomainName
	_, err = customDomainsClient.Get(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		testsuite.appName,
		domainName,
		nil)
	testsuite.Require().NoError(err)

	// From step CustomDomains_List
	customDomainsClientListPager := customDomainsClient.List(testsuite.resourceGroupName,
		testsuite.serviceName,
		testsuite.appName,
		nil)
	for customDomainsClientListPager.NextPage(testsuite.ctx) {
		err = customDomainsClientListPager.Err()
		testsuite.Require().NoError(err)
		for _, v := range customDomainsClientListPager.PageResponse().Value {
			_ = v
		}
	}

	// From step Apps_GetResourceUploadUrl
	appsClientGetResourceUploadURLResponse, err := appsClient.GetResourceUploadURL(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		testsuite.appName,
		nil)
	testsuite.Require().NoError(err)
	relativePath = *appsClientGetResourceUploadURLResponse.RelativePath
	uploadUrl = *appsClientGetResourceUploadURLResponse.UploadURL

	// From step Upload_File
	template := map[string]interface{}{
		"$schema":        "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
		"contentVersion": "1.0.0.0",
		"parameters": map[string]interface{}{
			"userAssignedIdentity": map[string]interface{}{
				"type":         "string",
				"defaultValue": "$(userAssignedIdentity)",
			},
			"utcValue": map[string]interface{}{
				"type":         "string",
				"defaultValue": "[utcNow()]",
			},
		},
		"resources": []interface{}{
			map[string]interface{}{
				"name":       "Upload_File",
				"type":       "Microsoft.Resources/deploymentScripts",
				"apiVersion": "2020-10-01",
				"identity": map[string]interface{}{
					"type": "UserAssigned",
					"userAssignedIdentities": map[string]interface{}{
						"[parameters('userAssignedIdentity')]": map[string]interface{}{},
					},
				},
				"kind":     "AzurePowerShell",
				"location": "[resourceGroup().location]",
				"properties": map[string]interface{}{
					"azPowerShellVersion": "6.2",
					"cleanupPreference":   "OnSuccess",
					"environmentVariables": []interface{}{
						map[string]interface{}{
							"name":        "uploadUrl",
							"secureValue": uploadUrl,
						},
						map[string]interface{}{
							"name":        "blobUrl",
							"secureValue": testsuite.blobUrl,
						},
					},
					"forceUpdateTag":    "[parameters('utcValue')]",
					"retentionInterval": "P1D",
					"scriptContent": "$uploadUri = ${Env:uploadUrl}\n$blobUri = ${Env:blobUrl}\n$localFilePath = '/tmp/temp.file'\nfunction DownloadJarFromBlob([string]$blobUri, [string]$localOutputFilePath) {\n	$BlobFile = [Microsoft.WindowsAzure.Storage.Blob.CloudBlob]::new($blobUri)\n	$DownLoadTask = $BlobFile.DownloadToFileAsync($localOutputFilePath, 4)\n	$DownLoadTask\n}\n\nfunction UploadToFileShare([string]$uploadUri, [string]$localFilePath) {\n	$CloudFile = [Microsoft.WindowsAzure.Storage.File.CloudFile]::New($uploadUri)\n	$UploadTask = $CloudFile.UploadFromFileAsync($localFilePath)\n	$UploadTask\n}\n\nConnect-AzAccount -Identity\nDownloadJarFromBlob $blobUri $localFilePath\nUploadToFileShare $uploadUri $localFilePath",
					"timeout": "PT1H",
				},
			},
		},
	}
	params := map[string]interface{}{
		"userAssignedIdentity": map[string]interface{}{"value": testsuite.userAssignedIdentity},
	}
	deployment := armresources.Deployment{
		Properties: &armresources.DeploymentProperties{
			Template:   template,
			Parameters: params,
			Mode:       armresources.DeploymentModeIncremental.ToPtr(),
		},
	}
	_, err = testutil.CreateDeployment(testsuite.ctx, testsuite.subscriptionId, testsuite.cred, testsuite.options, testsuite.resourceGroupName, "Upload_File", &deployment)
	testsuite.Require().NoError(err)

	// From step Deployments_CreateOrUpdate
	deploymentName = "blue"
	deploymentsClientCreateOrUpdatePollerResponse, err = deploymentsClient.BeginCreateOrUpdate(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		testsuite.appName,
		deploymentName,
		test.DeploymentResource{
			Properties: &test.DeploymentResourceProperties{
				DeploymentSettings: &test.DeploymentSettings{
					CPU: to.Int32Ptr(1),
					EnvironmentVariables: map[string]*string{
						"env": to.StringPtr("test"),
					},
					JvmOptions:     to.StringPtr("-Xms1G -Xmx3G"),
					MemoryInGB:     to.Int32Ptr(3),
					RuntimeVersion: test.RuntimeVersionJava8.ToPtr(),
				},
				Source: &test.UserSourceInfo{
					Type:             test.UserSourceTypeJar.ToPtr(),
					ArtifactSelector: to.StringPtr("sub-module-1"),
					RelativePath:     to.StringPtr(relativePath),
					Version:          to.StringPtr("1.0"),
				},
			},
			SKU: &test.SKU{
				Name:     to.StringPtr("S0"),
				Capacity: to.Int32Ptr(2),
				Tier:     to.StringPtr("Standard"),
			},
		},
		nil)
	testsuite.Require().NoError(err)
	if recording.GetRecordMode() == recording.PlaybackMode {
		for {
			_, err = deploymentsClientCreateOrUpdatePollerResponse.Poller.Poll(testsuite.ctx)
			testsuite.Require().NoError(err)
			if deploymentsClientCreateOrUpdatePollerResponse.Poller.Done() {
				_, err = deploymentsClientCreateOrUpdatePollerResponse.Poller.FinalResponse(testsuite.ctx)
				testsuite.Require().NoError(err)
				break
			}
		}
	} else {
		_, err = deploymentsClientCreateOrUpdatePollerResponse.PollUntilDone(testsuite.ctx, 10*time.Second)
		testsuite.Require().NoError(err)
	}

	// From step Apps_Update
	appsClientUpdatePollerResponse, err = appsClient.BeginUpdate(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		testsuite.appName,
		test.AppResource{
			Identity: &test.ManagedIdentityProperties{
				Type:        test.ManagedIdentityTypeSystemAssigned.ToPtr(),
				PrincipalID: to.StringPtr("principalid"),
				TenantID:    to.StringPtr("tenantid"),
			},
			Properties: &test.AppResourceProperties{
				ActiveDeploymentName: to.StringPtr("blue"),
			},
		},
		nil)
	testsuite.Require().NoError(err)
	if recording.GetRecordMode() == recording.PlaybackMode {
		for {
			_, err = appsClientUpdatePollerResponse.Poller.Poll(testsuite.ctx)
			testsuite.Require().NoError(err)
			if appsClientUpdatePollerResponse.Poller.Done() {
				_, err = appsClientUpdatePollerResponse.Poller.FinalResponse(testsuite.ctx)
				testsuite.Require().NoError(err)
				break
			}
		}
	} else {
		_, err = appsClientUpdatePollerResponse.PollUntilDone(testsuite.ctx, 10*time.Second)
		testsuite.Require().NoError(err)
	}

	// From step Deployments_Restart
	deploymentName = "blue"
	deploymentsClientRestartPollerResponse, err := deploymentsClient.BeginRestart(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		testsuite.appName,
		deploymentName,
		nil)
	testsuite.Require().NoError(err)
	if recording.GetRecordMode() == recording.PlaybackMode {
		for {
			_, err = deploymentsClientRestartPollerResponse.Poller.Poll(testsuite.ctx)
			testsuite.Require().NoError(err)
			if deploymentsClientRestartPollerResponse.Poller.Done() {
				_, err = deploymentsClientRestartPollerResponse.Poller.FinalResponse(testsuite.ctx)
				testsuite.Require().NoError(err)
				break
			}
		}
	} else {
		_, err = deploymentsClientRestartPollerResponse.PollUntilDone(testsuite.ctx, 10*time.Second)
		testsuite.Require().NoError(err)
	}

	// From step Deployments_Stop
	deploymentName = "blue"
	deploymentsClientStopPollerResponse, err := deploymentsClient.BeginStop(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		testsuite.appName,
		deploymentName,
		nil)
	testsuite.Require().NoError(err)
	if recording.GetRecordMode() == recording.PlaybackMode {
		for {
			_, err = deploymentsClientStopPollerResponse.Poller.Poll(testsuite.ctx)
			testsuite.Require().NoError(err)
			if deploymentsClientStopPollerResponse.Poller.Done() {
				_, err = deploymentsClientStopPollerResponse.Poller.FinalResponse(testsuite.ctx)
				testsuite.Require().NoError(err)
				break
			}
		}
	} else {
		_, err = deploymentsClientStopPollerResponse.PollUntilDone(testsuite.ctx, 10*time.Second)
		testsuite.Require().NoError(err)
	}

	// From step Deployments_Start
	deploymentName = "blue"
	deploymentsClientStartPollerResponse, err := deploymentsClient.BeginStart(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		testsuite.appName,
		deploymentName,
		nil)
	testsuite.Require().NoError(err)
	if recording.GetRecordMode() == recording.PlaybackMode {
		for {
			_, err = deploymentsClientStartPollerResponse.Poller.Poll(testsuite.ctx)
			testsuite.Require().NoError(err)
			if deploymentsClientStartPollerResponse.Poller.Done() {
				_, err = deploymentsClientStartPollerResponse.Poller.FinalResponse(testsuite.ctx)
				testsuite.Require().NoError(err)
				break
			}
		}
	} else {
		_, err = deploymentsClientStartPollerResponse.PollUntilDone(testsuite.ctx, 10*time.Second)
		testsuite.Require().NoError(err)
	}

	// From step Deployments_GetLogFileUrl
	deploymentName = "blue"
	_, err = deploymentsClient.GetLogFileURL(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		testsuite.appName,
		deploymentName,
		nil)
	testsuite.Require().NoError(err)

	// From step Deployments_List
	deploymentsClientListPager := deploymentsClient.List(testsuite.resourceGroupName,
		testsuite.serviceName,
		testsuite.appName,
		&test.DeploymentsClientListOptions{Version: []string{}})
	for deploymentsClientListPager.NextPage(testsuite.ctx) {
		err = deploymentsClientListPager.Err()
		testsuite.Require().NoError(err)
		for _, v := range deploymentsClientListPager.PageResponse().Value {
			_ = v
		}
	}

	// From step Deployments_ListForCluster
	deploymentsClientListForClusterPager := deploymentsClient.ListForCluster(testsuite.resourceGroupName,
		testsuite.serviceName,
		&test.DeploymentsClientListForClusterOptions{Version: []string{}})
	for deploymentsClientListForClusterPager.NextPage(testsuite.ctx) {
		err = deploymentsClientListForClusterPager.Err()
		testsuite.Require().NoError(err)
		for _, v := range deploymentsClientListForClusterPager.PageResponse().Value {
			_ = v
		}
	}

	// From step Services_List
	servicesClientListPager := servicesClient.List(testsuite.resourceGroupName,
		nil)
	for servicesClientListPager.NextPage(testsuite.ctx) {
		err = servicesClientListPager.Err()
		testsuite.Require().NoError(err)
		for _, v := range servicesClientListPager.PageResponse().Value {
			_ = v
		}
	}

	// From step Services_ListBySubscription
	servicesClientListBySubscriptionPager := servicesClient.ListBySubscription(nil)
	for servicesClientListBySubscriptionPager.NextPage(testsuite.ctx) {
		err = servicesClientListBySubscriptionPager.Err()
		testsuite.Require().NoError(err)
		for _, v := range servicesClientListBySubscriptionPager.PageResponse().Value {
			_ = v
		}
	}

	// From step Deployments_Delete
	deploymentName = "blue"
	deploymentsClientDeletePollerResponse, err := deploymentsClient.BeginDelete(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		testsuite.appName,
		deploymentName,
		nil)
	testsuite.Require().NoError(err)
	if recording.GetRecordMode() == recording.PlaybackMode {
		for {
			_, err = deploymentsClientDeletePollerResponse.Poller.Poll(testsuite.ctx)
			testsuite.Require().NoError(err)
			if deploymentsClientDeletePollerResponse.Poller.Done() {
				_, err = deploymentsClientDeletePollerResponse.Poller.FinalResponse(testsuite.ctx)
				testsuite.Require().NoError(err)
				break
			}
		}
	} else {
		_, err = deploymentsClientDeletePollerResponse.PollUntilDone(testsuite.ctx, 10*time.Second)
		testsuite.Require().NoError(err)
	}

	// From step CustomDomains_Delete
	domainName = testsuite.dnsCname + "." + testsuite.customDomainName
	customDomainsClientDeletePollerResponse, err := customDomainsClient.BeginDelete(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		testsuite.appName,
		domainName,
		nil)
	testsuite.Require().NoError(err)
	if recording.GetRecordMode() == recording.PlaybackMode {
		for {
			_, err = customDomainsClientDeletePollerResponse.Poller.Poll(testsuite.ctx)
			testsuite.Require().NoError(err)
			if customDomainsClientDeletePollerResponse.Poller.Done() {
				_, err = customDomainsClientDeletePollerResponse.Poller.FinalResponse(testsuite.ctx)
				testsuite.Require().NoError(err)
				break
			}
		}
	} else {
		_, err = customDomainsClientDeletePollerResponse.PollUntilDone(testsuite.ctx, 10*time.Second)
		testsuite.Require().NoError(err)
	}

	// From step Apps_Delete
	testsuite.appName = "app01"
	appsClientDeletePollerResponse, err := appsClient.BeginDelete(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		testsuite.appName,
		nil)
	testsuite.Require().NoError(err)
	if recording.GetRecordMode() == recording.PlaybackMode {
		for {
			_, err = appsClientDeletePollerResponse.Poller.Poll(testsuite.ctx)
			testsuite.Require().NoError(err)
			if appsClientDeletePollerResponse.Poller.Done() {
				_, err = appsClientDeletePollerResponse.Poller.FinalResponse(testsuite.ctx)
				testsuite.Require().NoError(err)
				break
			}
		}
	} else {
		_, err = appsClientDeletePollerResponse.PollUntilDone(testsuite.ctx, 10*time.Second)
		testsuite.Require().NoError(err)
	}

	// From step Certificates_Delete
	certificateName = "asc-certificate"
	certificatesClientDeletePollerResponse, err := certificatesClient.BeginDelete(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		certificateName,
		nil)
	testsuite.Require().NoError(err)
	if recording.GetRecordMode() == recording.PlaybackMode {
		for {
			_, err = certificatesClientDeletePollerResponse.Poller.Poll(testsuite.ctx)
			testsuite.Require().NoError(err)
			if certificatesClientDeletePollerResponse.Poller.Done() {
				_, err = certificatesClientDeletePollerResponse.Poller.FinalResponse(testsuite.ctx)
				testsuite.Require().NoError(err)
				break
			}
		}
	} else {
		_, err = certificatesClientDeletePollerResponse.PollUntilDone(testsuite.ctx, 10*time.Second)
		testsuite.Require().NoError(err)
	}

	// From step Services_Delete
	servicesClientDeletePollerResponse, err := servicesClient.BeginDelete(testsuite.ctx,
		testsuite.resourceGroupName,
		testsuite.serviceName,
		nil)
	testsuite.Require().NoError(err)
	if recording.GetRecordMode() == recording.PlaybackMode {
		for {
			_, err = servicesClientDeletePollerResponse.Poller.Poll(testsuite.ctx)
			testsuite.Require().NoError(err)
			if servicesClientDeletePollerResponse.Poller.Done() {
				_, err = servicesClientDeletePollerResponse.Poller.FinalResponse(testsuite.ctx)
				testsuite.Require().NoError(err)
				break
			}
		}
	} else {
		_, err = servicesClientDeletePollerResponse.PollUntilDone(testsuite.ctx, 10*time.Second)
		testsuite.Require().NoError(err)
	}

	// From step Skus_List
	sKUsClient := test.NewSKUsClient(testsuite.subscriptionId, testsuite.cred, testsuite.options)
	sKUsClientListPager := sKUsClient.List(nil)
	for sKUsClientListPager.NextPage(testsuite.ctx) {
		err = sKUsClientListPager.Err()
		testsuite.Require().NoError(err)
		for _, v := range sKUsClientListPager.PageResponse().Value {
			_ = v
		}
	}

	// From step Operations_List
	operationsClient := test.NewOperationsClient(testsuite.cred, testsuite.options)
	operationsClientListPager := operationsClient.List(nil)
	for operationsClientListPager.NextPage(testsuite.ctx) {
		err = operationsClientListPager.Err()
		testsuite.Require().NoError(err)
		for _, v := range operationsClientListPager.PageResponse().Value {
			_ = v
		}
	}
}

func (testsuite *SpringTestSuite) Cleanup() {
	var err error
	// From step delete_cname_record
	template := map[string]interface{}{
		"$schema":        "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
		"contentVersion": "1.0.0.0",
		"parameters": map[string]interface{}{
			"userAssignedIdentity": map[string]interface{}{
				"type":         "string",
				"defaultValue": "$(userAssignedIdentity)",
			},
			"utcValue": map[string]interface{}{
				"type":         "string",
				"defaultValue": "[utcNow()]",
			},
		},
		"resources": []interface{}{
			map[string]interface{}{
				"name":       "delete_cname_record",
				"type":       "Microsoft.Resources/deploymentScripts",
				"apiVersion": "2020-10-01",
				"identity": map[string]interface{}{
					"type": "UserAssigned",
					"userAssignedIdentities": map[string]interface{}{
						"[parameters('userAssignedIdentity')]": map[string]interface{}{},
					},
				},
				"kind":     "AzurePowerShell",
				"location": "[resourceGroup().location]",
				"properties": map[string]interface{}{
					"azPowerShellVersion": "6.2",
					"cleanupPreference":   "OnSuccess",
					"environmentVariables": []interface{}{
						map[string]interface{}{
							"name":  "resourceGroupName",
							"value": testsuite.dnsResourceGroup,
						},
						map[string]interface{}{
							"name":  "dnsCname",
							"value": "asc",
						},
						map[string]interface{}{
							"name":  "dnsZoneName",
							"value": testsuite.customDomainName,
						},
					},
					"forceUpdateTag":    "[parameters('utcValue')]",
					"retentionInterval": "P1D",
					"scriptContent":     "$resourceGroupName = ${Env:resourceGroupName}\n$dnsCNAME = ${Env:dnsCname}\n$dnsZoneName = ${Env:dnsZoneName}\n\nConnect-AzAccount -Identity\n\n$RecordSet = Get-AzDnsRecordSet -Name $dnsCname -RecordType CNAME -ResourceGroupName $resourceGroupName -ZoneName $dnsZoneName\n$Result = Remove-AzDnsRecordSet -RecordSet $RecordSet\n$Result",
					"timeout":           "PT1H",
				},
			},
		},
	}
	params := map[string]interface{}{
		"userAssignedIdentity": map[string]interface{}{"value": testsuite.userAssignedIdentity},
	}
	deployment := armresources.Deployment{
		Properties: &armresources.DeploymentProperties{
			Template:   template,
			Parameters: params,
			Mode:       armresources.DeploymentModeIncremental.ToPtr(),
		},
	}
	_, err = testutil.CreateDeployment(testsuite.ctx, testsuite.subscriptionId, testsuite.cred, testsuite.options, testsuite.resourceGroupName, "delete_cname_record", &deployment)
	testsuite.Require().NoError(err)
}
