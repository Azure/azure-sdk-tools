parameters:
  rootFolder: '$(Build.SourcesDirectory)'
  1ES: false

steps:
  - pwsh: |
      Copy-Item -Path "${{ parameters.rootFolder }}/test-proxy.log" -Destination "${{ parameters.rootFolder }}/proxy.log"
    displayName: Copy Log File
    condition: succeededOrFailed()

  - ${{ if eq(parameters.1ES, 'true') }}:
    - template: ../pipelines/templates/steps/publish-1es-artifact.yml
      parameters:
        ArtifactName: "$(System.StageName)-$(System.JobName)-$(System.JobAttempt)-proxy-logs"
        ArtifactPath: "${{ parameters.rootFolder }}/proxy.log"
        SbomEnabled: false
  - ${{ else }}:
    - template: ../pipelines/templates/steps/publish-artifact.yml
      parameters:
        ArtifactName: "$(System.StageName)-$(System.JobName)-$(System.JobAttempt)-proxy-logs"
        ArtifactPath: "${{ parameters.rootFolder }}/proxy.log"

  - pwsh: |
      Remove-Item -Force ${{ parameters.rootFolder }}/proxy.log
    displayName: Cleanup Copied Log File
    condition: succeededOrFailed()
